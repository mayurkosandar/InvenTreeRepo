import{r as o,i as t,j as s,m as H,er as V,aH as re,ci as oe,cT as B,Z as ne,ad as le,bI as y,a1 as ce,S as de}from"./vendor-BnaqX2_l.js";import{A as pe}from"./AdminButton-GD-Bfrm9.js";import{P as X}from"./PrimaryActionButton-DmbHLQKT.js";import{u as ue,R as me,j as _e,a as he,I as be,P as fe}from"./InvenTreeTable-rEa-i3pt.js";import{I as ye,D as w,a as xe}from"./InstanceDetail-DvLVYRQt.js";import{D as ke,N as ge}from"./NotesPanel-Dh1SrbjV.js";import{B as Ce,O as je,E as Pe,a as Ae,H as Se,C as ve}from"./ActionDropdown-D1A3arjv.js";import{C as Ie,S as Z}from"./BaseContext-CH9A7-TB.js";import{P as De}from"./PageDetail-Ct_zKLxm.js";import{A as Fe}from"./AttachmentPanel-Ct80LGG4.js";import{P as Re}from"./PanelGroup-CKTRVRga.js";import{h as Te,S as Le}from"./Instance-DrUTN1gu.js";import{b as Ee}from"./formatters-DBeaC9UC.js";import{a as $,m as r,A as c,U as _,e as I,l as Ne}from"./index-fPzgLVil.js";import{a as Me,b as J,u as Q}from"./PurchaseOrderForms-DPVzsVCo.js";import{u as x,a as ee,b as Oe,c as Y,A as qe}from"./UseForm-DwZIxEnj.js";import{u as we}from"./UseInstance-DbDyyJjp.js";import{u as te}from"./UseStatusCodes-CE5Vxrbg.js";import{E as We}from"./ExtraLineItemTable-BjFa9xNb.js";import{I as Ue,d as Ke}from"./ImporterForms-CldR_I2J.js";import{a as Be,R as Ge,f as He,P as Ve,L as z,j as Xe,k as Ze,T as Je,N as Qe}from"./ColumnRenderers-6jyK6a0i.js";import{S as Ye}from"./StockItemTable-Blig3z9s.js";import"./DesktopAppView-CAvOv5f4.js";import"./navigation-B-mN4luC.js";import"./dayjs.min-DlCiWWGX.js";import"./YesNoButton-W51do83Q.js";import"./GenericErrorPage-BDqvbBMU.js";import"./NotFound-Dr2EC1Qm.js";import"./PermissionDenied-BHX44oqK.js";import"./PageTitle-AnZP781e.js";import"./AttachmentLink-BJMgqQK8.js";import"./ApiIcon-Bqf-O7I2.js";import"./RemoteComponent-Who-27QQ.js";import"./RemoveRowButton-Dm_wD7jw.js";import"./UseGenerator-DOw_SLei.js";import"./CommonForms-D6scP564.js";import"./OrderPartsWizard-BFgDSSVd.js";import"./CompanyForms-yUzzFM8E.js";import"./UsePlaceholder-Dc_Ugorx.js";function ze({order:a,orderId:n,currency:D,supplierId:e,params:b}){const l=ue("purchase-order-line-item"),d=$(),[k,F]=o.useState(!1),[R,g]=o.useState(void 0),T=o.useMemo(()=>{var u;const i=Ke();return i.model_type.hidden=!0,i.model_type.value=r.purchaseorderlineitem,i.field_overrides.value={order:n},i.field_defaults.value={purchase_price_currency:(a==null?void 0:a.order_currency)||((u=a==null?void 0:a.supplier_detail)==null?void 0:u.currency)||void 0},i.field_filters.value={part:{supplier:e,active:!0}},i},[a,n,e]),L=x({url:c.import_session_list,title:t._({id:"yWWRAr"}),fields:T,onFormSuccess:i=>{g(i.pk),F(!0)}}),[E,m]=o.useState(null),C=Me({items:E?[E]:l.selectedRecords,orderPk:n,destinationPk:a.destination,formProps:{onClose:()=>{l.refreshTable(),setTimeout(()=>m(null),500)}}}),N=o.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),sortable:!0,ordering:"part_name",switchable:!1,render:i=>Be({part:i.part_detail})},{accessor:"part_detail.IPN",sortable:!0,ordering:"IPN"},{accessor:"part_detail.description",sortable:!1},Ge({}),{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:i=>{const u=(i==null?void 0:i.supplier_part_detail)??{},U=(i==null?void 0:i.part_detail)??(u==null?void 0:u.part_detail)??{},K=[];if((u==null?void 0:u.pack_quantity_native)!=null&&u.pack_quantity_native!=1){const ae=i.quantity*u.pack_quantity_native;K.push(s.jsxs(H,{children:[t._({id:"J9LTXQ"}),": ",u.pack_quantity]},"pack-quantity")),K.push(s.jsxs(H,{children:[t._({id:"GbI1d2"}),": ",ae," ",U==null?void 0:U.units]},"total-quantity"))}return s.jsx(He,{value:i.quantity,extra:K,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:i=>s.jsx(Ve,{progressLabel:!0,value:i.received,maximum:i.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:t._({id:"pD/Ew0"})},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"})},{accessor:"sku",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},z({accessor:"supplier_part_detail.link",title:t._({id:"h3/Rpt"}),sortable:!1}),{accessor:"mpn",ordering:"MPN",title:t._({id:"u7qly3"}),sortable:!0},Xe({accessor:"purchase_price",title:t._({id:"vWelsN"})}),Ze(),Je({}),{accessor:"destination",title:t._({id:"Enslfm"}),sortable:!1,render:i=>i.destination?Te({instance:i.destination_detail}):"-"},Qe({}),z({})],[n,d]),M=o.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"8Dmqxr"})}],[]),O=J({create:!0,orderId:n,supplierId:e}),[W,q]=o.useState({}),j=x({url:c.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:O,initialData:{...W,purchase_price_currency:D},table:l}),[p,P]=o.useState(0),v=J({create:!1,orderId:n,supplierId:e}),A=ee({url:c.purchase_order_line_list,pk:p,title:t._({id:"vgosWS"}),fields:v,table:l}),f=Oe({url:c.purchase_order_line_list,pk:p,title:t._({id:"tpKh8C"}),table:l}),h=te({modelType:r.purchaseorder}),S=o.useMemo(()=>a.status==h.PENDING||a.status==h.PLACED||a.status==h.ON_HOLD,[a,h]),G=o.useMemo(()=>a.status==h.PLACED,[a,h]),se=o.useCallback(i=>[{hidden:((i==null?void 0:i.received)??0)>=((i==null?void 0:i.quantity)??0)||!S,title:t._({id:"ul9IpB"}),icon:s.jsx(V,{}),color:"green",onClick:()=>{m(i),C.open()}},me({hidden:!d.hasChangeRole(_.purchase_order),onClick:()=>{P(i.pk),A.open()}}),_e({hidden:!S||!d.hasAddRole(_.purchase_order),onClick:()=>{q({...i}),j.open()}}),he({hidden:!d.hasDeleteRole(_.purchase_order),onClick:()=>{P(i.pk),f.open()}})],[n,d,S]),ie=o.useMemo(()=>[s.jsx(Y,{hidden:!S||!d.hasAddRole(_.purchase_order),tooltip:t._({id:"yWWRAr"}),icon:s.jsx(re,{}),onClick:()=>L.open()},"import-line-items"),s.jsx(qe,{tooltip:t._({id:"pwb7Yo"}),onClick:()=>{q({order:n}),j.open()},hidden:!S||!(d!=null&&d.hasAddRole(_.purchase_order))},"add-line-item"),s.jsx(Y,{text:t._({id:"gyK1dv"}),icon:s.jsx(V,{}),onClick:()=>C.open(),disabled:l.selectedRecords.length===0,hidden:!G||!d.hasChangeRole(_.purchase_order)},"receive-items")],[n,d,l,S,G]);return s.jsxs(s.Fragment,{children:[L.modal,C.modal,j.modal,A.modal,f.modal,s.jsx(be,{url:I(c.purchase_order_line_list),tableState:l,columns:N,props:{enableSelection:!0,enableDownload:!0,params:{...b,order:n,part_detail:!0},rowActions:se,tableActions:ie,tableFilters:M,modelType:r.supplierpart,modelField:"part"}}),s.jsx(Ue,{sessionId:R??-1,opened:R!=null&&k,onClose:()=>{g(void 0),F(!1),l.refreshTable()}})]})}function qt(){var j;const{id:a}=Ie(),n=$(),D=Ne(),{instance:e,instanceQuery:b,refreshInstance:l,requestStatus:d}=we({endpoint:c.purchase_order_list,pk:a,params:{supplier_detail:!0},refetchOnMount:!0}),k=o.useMemo(()=>{var p;return e.order_currency||((p=e.supplier_detail)==null?void 0:p.currency)||D.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,D]),F=Q({}),R=Q({duplicateOrderId:e.pk}),g=ee({url:c.purchase_order_list,pk:a,title:t._({id:"lAF9Uk"}),fields:F,onFormSuccess:()=>{l()}}),T=x({url:c.purchase_order_list,title:t._({id:"XRoR1U"}),fields:R,initialData:{...e,reference:void 0},follow:!0,modelType:r.purchaseorder}),L=o.useMemo(()=>{var f;if(b.isFetching)return s.jsx(oe,{});const p=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!e.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:r.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:r.purchaseorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:r.purchaseorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],P=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"link",model:r.stocklocation,link:!0,name:"destination",label:t._({id:"Enslfm"}),hidden:!e.destination},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>k},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var h;return Ee(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)??((h=e==null?void 0:e.supplier_detail)==null?void 0:h.currency)})}}],v=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"link",model:r.contact,link:!1,name:"contact",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code}],A=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar"},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}];return s.jsxs(ye,{children:[s.jsxs(B,{children:[s.jsx(B.Col,{span:4,children:s.jsx(ke,{appRole:_.purchase_order,apiPath:c.company_list,src:(f=e.supplier_detail)==null?void 0:f.image,pk:e.supplier})}),s.jsx(B.Col,{span:8,children:s.jsx(w,{fields:p,item:e})})]}),s.jsx(w,{fields:P,item:e}),s.jsx(w,{fields:v,item:e}),s.jsx(w,{fields:A,item:e})]})},[e,k,b]),E=o.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(ne,{}),content:L},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(le,{}),content:s.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(y.Item,{value:"line-items",children:[s.jsx(y.Control,{children:s.jsx(Z,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(y.Panel,{children:s.jsx(ze,{order:e,currency:k,orderId:Number(a),supplierId:Number(e.supplier)})})]},"lineitems"),s.jsxs(y.Item,{value:"extra-items",children:[s.jsx(y.Control,{children:s.jsx(Z,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(y.Panel,{children:s.jsx(We,{endpoint:c.purchase_order_extra_line_list,orderId:e.pk,currency:k,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:t._({id:"b447qM"}),icon:s.jsx(ce,{}),content:s.jsx(Ye,{tableName:"received-stock",params:{purchase_order:a}})},Fe({model_type:r.purchaseorder,model_id:e.pk}),ge({model_type:r.purchaseorder,model_id:e.pk})],[e,a,n]),m=te({modelType:r.purchaseorder}),C=x({url:I(c.purchase_order_issue,e.pk),title:t._({id:"keApR9"}),onFormSuccess:l,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),N=x({url:I(c.purchase_order_cancel,e.pk),title:t._({id:"98xQHK"}),onFormSuccess:l,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),M=x({url:I(c.purchase_order_hold,e.pk),title:t._({id:"vJaCK0"}),onFormSuccess:l,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),O=x({url:I(c.purchase_order_complete,e.pk),title:t._({id:"CWbcdO"}),successMessage:t._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:l,preFormWarning:t._({id:"DYITap"})}),W=o.useMemo(()=>{const p=n.hasChangeRole(_.purchase_order),P=p&&(e.status==m.PENDING||e.status==m.ON_HOLD),v=p&&(e.status==m.PENDING||e.status==m.PLACED),A=p&&e.status==m.PLACED,f=p&&e.status!=m.CANCELLED&&e.status!=m.COMPLETE;return[s.jsx(X,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!P,color:"blue",onClick:C.open}),s.jsx(X,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!A,color:"green",onClick:O.open}),s.jsx(pe,{model:r.purchaseorder,id:e.pk}),s.jsx(Ce,{model:r.purchaseorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),s.jsx(fe,{modelType:r.purchaseorder,items:[e.pk],enableReports:!0}),s.jsx(je,{tooltip:t._({id:"/IKytX"}),actions:[Pe({hidden:!p,tooltip:t._({id:"mVeaUg"}),onClick:()=>{g.open()}}),Ae({hidden:!n.hasAddRole(_.purchase_order),onClick:()=>T.open(),tooltip:t._({id:"oi/3Pq"})}),Se({tooltip:t._({id:"20mLBC"}),hidden:!v,onClick:M.open}),ve({tooltip:t._({id:"tVJk4q"}),hidden:!f,onClick:N.open})]})]},[a,e,n,m]),q=o.useMemo(()=>b.isLoading?[]:[s.jsx(Le,{status:e.status_custom_key,type:r.purchaseorder,options:{size:"lg"}})],[e,b]);return s.jsxs(s.Fragment,{children:[C.modal,M.modal,N.modal,O.modal,g.modal,T.modal,s.jsx(xe,{status:d,loading:b.isFetching,requiredRole:_.purchase_order,children:s.jsxs(de,{gap:"xs",children:[s.jsx(De,{title:`${t._({id:"KxySMG"})}: ${e.reference}`,subtitle:e.description,imageUrl:(j=e.supplier_detail)==null?void 0:j.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],actions:W,badges:q,editAction:g.open,editEnabled:n.hasChangePermission(r.purchaseorder)}),s.jsx(Re,{pageKey:"purchaseorder",panels:E,model:r.purchaseorder,instance:e,id:e.pk})]})})]})}export{qt as default};
