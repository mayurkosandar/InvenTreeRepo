import{r as n,i as a,j as t,au as G,aY as J,S as L,J as B,G as C,d6 as w,aw as V,m as I,bC as Y,n as D,ar as Z,ci as q}from"./vendor-BnaqX2_l.js";import{a as h}from"./NotesPanel-Dh1SrbjV.js";import{a as Q,e as H,A as K,d as O}from"./index-fPzgLVil.js";import{u as W,a as X,b as $,c as T}from"./UseForm-DwZIxEnj.js";import{A as v}from"./AttachmentLink-BJMgqQK8.js";import{a as N}from"./formatters-DBeaC9UC.js";import{u as y,R as ee,a as te,I as ae}from"./InvenTreeTable-rEa-i3pt.js";function se(){return[{accessor:"attachment",sortable:!1,switchable:!1,noWrap:!0,render:e=>e.attachment?t.jsx(v,{attachment:e.attachment}):e.link?t.jsx(v,{attachment:e.link,external:!0}):"-",noContext:!0},{accessor:"comment",sortable:!1,render:e=>e.comment},{accessor:"upload_date",sortable:!0,render:e=>t.jsxs(C,{justify:"space-between",children:[t.jsx(I,{children:e.upload_date}),e.user_detail&&t.jsx(Y,{size:"xs",children:e.user_detail.username})]})},{accessor:"file_size",sortable:!0,switchable:!0,render:e=>e.attachment?N(e.file_size):"-"}]}function ne({model_type:e,model_id:o}){const r=Q(),i=y(`${e}-attachments`),M=n.useMemo(()=>se(),[]),c=H(K.attachment_list),j=n.useMemo(()=>o>0,[o]),p=n.useMemo(()=>r.hasDeletePermission(e),[r,e]),[P,k]=n.useState(!1),E=n.useMemo(()=>r.hasAddPermission(e),[r,e]);function _(s){s.forEach(b=>{const m=new FormData;m.append("attachment",b),m.append("model_type",e),m.append("model_id",o.toString()),k(!0),O.post(c,m).then(u=>(D.show({title:a._({id:"FJqE4H"}),message:a._({id:"3LxYDr",values:{0:b.name}}),color:"green"}),i.refreshTable(),u)).catch(u=>(console.error("error uploading attachment:",b,"->",u),D.show({title:a._({id:"ae3dey"}),message:a._({id:"GZnmeE"}),color:"red"}),u)).finally(()=>{k(!1)})})}const[x,A]=n.useState("attachment"),[l,d]=n.useState(void 0),g=n.useMemo(()=>{const s={model_type:{value:e,hidden:!0},model_id:{value:o,hidden:!0},attachment:{},link:{},comment:{}};return x!="link"&&delete s.link,(x!="attachment"||l)&&delete s.attachment,s},[e,o,x,l]),f=W({url:c,title:a._({id:"p1w/D6"}),fields:g,onFormSuccess:()=>{i.refreshTable()}}),S=X({url:c,pk:l,title:a._({id:"MVvhJ1"}),fields:g,onFormSuccess:s=>{s.pk?i.updateRecord(s):i.refreshTable()}}),F=$({url:c,pk:l,title:a._({id:"hZfPb3"}),onFormSuccess:()=>{i.refreshTable()}}),z=n.useMemo(()=>[{name:"is_link",label:a._({id:"3QegpG"}),description:a._({id:"r1FQZj"})},{name:"is_file",label:a._({id:"JT83gz"}),description:a._({id:"5LI39K"})}],[]),R=n.useMemo(()=>[t.jsx(T,{tooltip:a._({id:"V8euYO"}),hidden:!r.hasAddPermission(e),icon:t.jsx(G,{}),onClick:()=>{A("attachment"),d(void 0),f.open()}},"add-attachment"),t.jsx(T,{tooltip:a._({id:"DpV4ac"}),hidden:!r.hasAddPermission(e),icon:t.jsx(J,{}),onClick:()=>{A("link"),d(void 0),f.open()}},"add-external-link")],[r,e]),U=n.useCallback(s=>[ee({hidden:!r.hasChangePermission(e),onClick:()=>{d(s.pk),S.open()}}),te({hidden:!p,onClick:()=>{d(s.pk),F.open()}})],[r,e]);return t.jsxs(t.Fragment,{children:[f.modal,S.modal,F.modal,t.jsxs(L,{gap:"xs",children:[j&&t.jsx(ae,{url:c,tableState:i,columns:M,props:{noRecordsText:a._({id:"32o8IC"}),enableSelection:p,enableBulkDelete:p,tableActions:R,tableFilters:z,rowActions:U,params:{model_type:e,model_id:o}}},"attachment-table"),E&&j&&t.jsx(B,{p:"md",shadow:"xs",radius:"md",children:t.jsx(h,{onDrop:_,loading:P,children:t.jsxs(C,{justify:"center",gap:"lg",mih:100,children:[t.jsx(h.Accept,{children:t.jsx(w,{style:{color:"var(--mantine-color-blue-6)"},stroke:1.5})}),t.jsx(h.Reject,{children:t.jsx(V,{style:{color:"var(--mantine-color-red-6)"},stroke:1.5})}),t.jsx(h.Idle,{children:t.jsx(w,{style:{color:"var(--mantine-color-dimmed)"},stroke:1.5})}),t.jsx(I,{size:"sm",children:a._({id:"1cbxaa"})})]})},"attachment-dropzone")})]})]})}function ue({model_type:e,model_id:o}){return{name:"attachments",label:a._({id:"w/Sphq"}),icon:t.jsx(Z,{}),content:e&&o?t.jsx(ne,{model_type:e,model_id:o}):t.jsx(q,{})}}export{ue as A};
