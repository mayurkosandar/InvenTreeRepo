import{ce as F,j as e,G as x,bz as C,eP as K,C as P,by as R,eQ as W,m as h,i,v,eR as J,eS as Q,eT as X,eU as $,eV as ee,eW as se,eX as te,eY as ie,eZ as ne,e_ as re,e$ as ae,f0 as oe,s as M,r as S,bB as L,S as T,bT as _,f1 as y,A as k,L as le,ac as de,f2 as ce,az as ue,B as xe,x as je,f3 as me,bE as ge,f4 as N,T as pe,bO as he,aM as fe,l as be,J as _e}from"./vendor-BnaqX2_l.js";import{d as B,b as G,T as l}from"./BaseContext-CH9A7-TB.js";import{u as Ie,d as ve}from"./DesktopAppView-CAvOv5f4.js";import{c as I,d as H,e as U,A as V,a as we,G as D,H as b,J as q,K as Se,u as Y,N as Le,O as ke}from"./index-fPzgLVil.js";import{L as Ee,C as Te}from"./LanguageSelect-C0CTtxn0.js";import{u as E}from"./use-form-aWop1uoQ.js";function ye(){const[t,o]=F();return e.jsxs(x,{justify:"center",style:{border:t===!0?"1px dashed":"",margin:t===!0?2:12,padding:t===!0?8:0},children:[e.jsx(C,{onClick:()=>o.toggle(),size:"lg",variant:"transparent",children:e.jsx(K,{})}),t&&e.jsx(x,{children:e.jsx(Ee,{})})]})}function Fe({hostname:t,toggleHostEdit:o}){const[s]=I(r=>[r.server]);return e.jsx(P,{mx:"md",children:e.jsxs(x,{children:[e.jsx(Te,{}),e.jsx(ye,{}),window.INVENTREE_SETTINGS.show_server_selector&&e.jsx(R,{label:t,children:e.jsx(W,{onClick:o})}),e.jsxs(h,{c:"dimmed",children:[s.version," | ",s.apiVersion]})]})})}const Ce={google:e.jsx(Q,{}),github:e.jsx(X,{}),facebook:e.jsx($,{}),discord:e.jsx(ee,{}),twitter:e.jsx(se,{}),bitbucket:e.jsx(te,{}),flickr:e.jsx(ie,{}),gitlab:e.jsx(ne,{}),reddit:e.jsx(re,{}),twitch:e.jsx(ae,{}),microsoft:e.jsx(oe,{})};function Z({provider:t}){function o(){H.put(U(V.ui_preference),{preferred_method:"pui"},{headers:{Authorization:""}}).then(()=>{window.location.href=t.login}).catch(()=>{M({title:i._({id:"SlfejT"}),message:i._({id:"cp/ywO"}),color:"red"})})}return e.jsx(R,{label:t.login?i._({id:"pQOGQK"}):i._({id:"h6Wnsp"}),children:e.jsx(v,{leftSection:Be(t),radius:"xl",component:"a",onClick:o,disabled:!t.login,children:t.display_name})})}function Be(t){return Ce[t.id]||e.jsx(J,{})}function ze(){const t=E({initialValues:{username:"",password:""}}),o=E({initialValues:{email:""}}),[s,r]=F(!0),[a]=I(d=>[d.auth_settings]),u=B(),j=G(),{isLoggedIn:n}=we(),[m,g]=S.useState(!1);function c(){g(!0),s===!0?D(t.values.username,t.values.password).then(()=>{g(!1),n()?(b({title:i._({id:"6cPKtu"}),message:i._({id:"uKMMk4"})}),q(u,j==null?void 0:j.state)):b({title:i._({id:"4GKuCs"}),message:i._({id:"tnaYa/"}),success:!1})}).catch(()=>{M({title:i._({id:"4GKuCs"}),message:i._({id:"tnaYa/"}),color:"red"})}):Se(o.values.email).then(d=>{g(!1),(d==null?void 0:d.status)==="ok"?b({title:i._({id:"XAIcYu"}),message:i._({id:"R2JMfc"})}):b({title:i._({id:"MMJM0z"}),message:i._({id:"tnaYa/"}),success:!1})})}return e.jsxs(e.Fragment,{children:[(a==null?void 0:a.sso_enabled)===!0?e.jsxs(e.Fragment,{children:[e.jsx(x,{grow:!0,mb:"md",mt:"md",children:a.providers.map(d=>e.jsx(Z,{provider:d},d.id))}),e.jsx(L,{label:i._({id:"zTZjMy"}),labelPosition:"center",my:"lg"})]}):null,e.jsxs("form",{onSubmit:t.onSubmit(()=>{}),children:[s?e.jsxs(T,{gap:0,children:[e.jsx(_,{required:!0,label:i._({id:"7sNhEz"}),"aria-label":"login-username",placeholder:i._({id:"k1RkIL"}),...t.getInputProps("username")}),e.jsx(y,{required:!0,label:i._({id:"8ZsakT"}),"aria-label":"login-password",placeholder:i._({id:"9TO8nT"}),...t.getInputProps("password")}),(a==null?void 0:a.password_forgotten_enabled)===!0&&e.jsx(x,{justify:"space-between",mt:"0",children:e.jsx(k,{component:"button",type:"button",c:"dimmed",size:"xs",onClick:()=>u("/reset-password"),children:e.jsx(l,{id:"RfwZxd"})})})]}):e.jsx(T,{children:e.jsx(_,{required:!0,label:i._({id:"O3oNi5"}),description:i._({id:"Wr5sDQ"}),placeholder:"email@example.org",...o.getInputProps("email")})}),e.jsxs(x,{justify:"space-between",mt:"xl",children:[e.jsx(k,{component:"button",type:"button",c:"dimmed",size:"xs",onClick:()=>r.toggle(),children:s?e.jsx(l,{id:"7ZOmjI"}):e.jsx(l,{id:"vZk5Sm"})}),e.jsx(v,{type:"submit",disabled:m,onClick:c,children:m?e.jsx(le,{size:"sm"}):e.jsx(e.Fragment,{children:s?e.jsx(l,{id:"ADVQ46"}):e.jsx(l,{id:"i/TzEU"})})})]})]})]})}function Ae(){const t=E({initialValues:{username:"",email:"",password1:"",password2:""}}),o=B(),[s]=I(n=>[n.auth_settings]),[r,a]=S.useState(!1);function u(){a(!0),H.post(U(V.user_register),t.values,{headers:{Authorization:""}}).then(n=>{((n==null?void 0:n.status)===204||(n==null?void 0:n.status)===201)&&(a(!1),b({title:i._({id:"EoCs7m"}),message:i._({id:"n2c6Ul"})}),o("/home"))}).catch(n=>{var m,g,c;if(((m=n.response)==null?void 0:m.status)===400){a(!1);for(const[f,w]of Object.entries(n.response.data))t.setFieldError(f,w);let d="";(c=(g=n.response)==null?void 0:g.data)!=null&&c.non_field_errors&&(d=n.response.data.non_field_errors),b({title:i._({id:"ccnxuA"}),message:i._({id:"tnaYa/"})+d,success:!1})}})}const j=(s==null?void 0:s.registration_enabled)&&(s==null?void 0:s.sso_registration);return e.jsxs(e.Fragment,{children:[(s==null?void 0:s.registration_enabled)&&e.jsxs("form",{onSubmit:t.onSubmit(()=>{}),children:[e.jsxs(T,{gap:0,children:[e.jsx(_,{required:!0,label:i._({id:"7sNhEz"}),"aria-label":"register-username",placeholder:i._({id:"k1RkIL"}),...t.getInputProps("username")}),e.jsx(_,{required:!0,label:i._({id:"O3oNi5"}),"aria-label":"register-email",description:i._({id:"kXXdWU"}),placeholder:"email@example.org",...t.getInputProps("email")}),e.jsx(y,{required:!0,label:i._({id:"8ZsakT"}),"aria-label":"register-password",placeholder:i._({id:"9TO8nT"}),...t.getInputProps("password1")}),e.jsx(y,{required:!0,label:i._({id:"NK5XEe"}),"aria-label":"register-password-repeat",placeholder:i._({id:"R1OtIL"}),...t.getInputProps("password2")})]}),e.jsx(x,{justify:"space-between",mt:"xl",children:e.jsx(v,{type:"submit",disabled:r,onClick:u,fullWidth:!0,children:e.jsx(l,{id:"fgLNSM"})})})]}),j&&e.jsx(L,{label:i._({id:"IES56a"}),labelPosition:"center",my:"lg"}),(s==null?void 0:s.sso_registration)===!0&&e.jsx(x,{grow:!0,mb:"md",mt:"md",children:s.providers.map(n=>e.jsx(Z,{provider:n},n.id))})]})}function Oe({loginMode:t,setMode:o}){const[s]=I(a=>[a.auth_settings]);return((s==null?void 0:s.registration_enabled)||(s==null?void 0:s.sso_registration)||!1)===!1?null:e.jsx(h,{ta:"center",size:"xs",mt:"md",children:t?e.jsxs(e.Fragment,{children:[e.jsx(l,{id:"ln9/n9"})," ",e.jsx(k,{component:"button",type:"button",c:"dimmed",size:"xs",onClick:()=>o.close(),children:e.jsx(l,{id:"fgLNSM"})})]}):e.jsx(k,{component:"button",type:"button",c:"dimmed",size:"xs",onClick:()=>o.open(),children:e.jsx(l,{id:"jZUk0D"})})})}function O({setEditing:t,editing:o,disabled:s,saveIcon:r}){return r=r||e.jsx(ce,{}),e.jsx(C,{onClick:()=>t(),disabled:s,variant:"default",children:o?r:e.jsx(de,{})})}function Pe({data:t,saveOptions:o}){const s=E({initialValues:t});function r(u){const j=s.values;delete j[u],s.setValues(j)}const a=Object.entries(s.values).map(([u])=>e.jsx(x,{mt:"xs",children:s.values[u]!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{placeholder:i._({id:"Ai2U7L"}),withAsterisk:!0,style:{flex:1},...s.getInputProps(`${u}.host`)}),e.jsx(_,{placeholder:i._({id:"6YtxFj"}),withAsterisk:!0,style:{flex:1},...s.getInputProps(`${u}.name`)}),e.jsx(C,{color:"red",onClick:()=>{r(u)},variant:"default",children:e.jsx(ue,{})})]})},u));return e.jsx("form",{onSubmit:s.onSubmit(o),children:e.jsxs(xe,{style:{maxWidth:500},mx:"auto",children:[a.length>0?e.jsxs(x,{mb:"xs",children:[e.jsx(h,{fw:500,size:"sm",style:{flex:1},children:e.jsx(l,{id:"Ai2U7L"})}),e.jsx(h,{fw:500,size:"sm",style:{flex:1},children:e.jsx(l,{id:"6YtxFj"})})]}):e.jsx(h,{c:"dimmed",ta:"center",children:e.jsx(l,{id:"yWMzcH"})}),a,e.jsxs(x,{mt:"md",children:[e.jsxs(v,{onClick:()=>s.setFieldValue(`${je()}`,{name:"",host:""}),children:[e.jsx(me,{}),e.jsx(l,{id:"UYWLpE"})]}),e.jsx(ge,{style:{flex:1}}),e.jsx(v,{type:"submit",children:e.jsx(l,{id:"tfDRzk"})})]})]})})}function Re({hostKey:t,ChangeHost:o,setHostEdit:s}){const[r,a]=N([!1,!0]),[u,j,n]=Y(c=>[c.setHost,c.setHostList,c.hostList]),m=Object.keys(n).map(c=>{var d;return{value:c,label:(d=n[c])==null?void 0:d.name}});function g(c){j(c),c[t]===void 0&&u("",""),a()}return e.jsxs(e.Fragment,{children:[e.jsx(pe,{order:3,children:e.jsx(l,{id:"GG8+B2"})}),e.jsxs(x,{children:[e.jsxs(x,{children:[e.jsx(he,{value:t,onChange:o,data:m,disabled:r}),e.jsx(O,{setEditing:a,editing:r,disabled:r})]}),e.jsx(O,{setEditing:s,editing:!0,disabled:r,saveIcon:e.jsx(fe,{})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(L,{my:"sm"}),e.jsx(h,{children:e.jsx(l,{id:"uqEJlE"})}),e.jsx(Pe,{data:n,saveOptions:g})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{my:"sm"}),e.jsx(Me,{hostList:n,hostKey:t})]})]})}function Me({hostList:t,hostKey:o}){var r;const[s]=I(a=>[a.server]);return e.jsxs(h,{children:[(r=t[o])==null?void 0:r.host,e.jsx("br",{}),e.jsx(l,{id:"GUtCZC",values:{0:s.version}}),e.jsx("br",{}),e.jsx(l,{id:"4/F1y3",values:{0:s.apiVersion}}),e.jsx("br",{}),e.jsx(l,{id:"UVRlfm",values:{0:s.instance}}),e.jsx("br",{}),e.jsx(l,{id:"ed0N/H",values:{0:s.worker_pending_tasks,1:s.plugins_enabled?` (${s.active_plugins.length})`:null},components:{0:e.jsx(h,{span:!0,c:s.worker_running?"green":"red"}),1:e.jsx(h,{span:!0,c:s.plugins_enabled?"green":"red"})}})]})}function qe(){var z;const[t,o,s]=Y(p=>[p.hostKey,p.setHost,p.hostList]),[r,a]=I(p=>[p.server,p.fetchServerApiState]),u=s[t]===void 0?i._({id:"bX1aQ5"}):(z=s[t])==null?void 0:z.name,[j,n]=N([!1,!0]),[m,g]=F(!0),c=B(),d=G(),[f]=Ie();function w(p){var A;p!==null&&(o((A=s[p])==null?void 0:A.host,p),ke(),a())}return S.useEffect(()=>{t===""&&w(ve),Le(c,d==null?void 0:d.state,!0),f.has("login")&&f.has("password")&&D(f.get("login")??"",f.get("password")??"").then(()=>{q(c,d==null?void 0:d.state)})},[]),S.useEffect(()=>{r.server===null&&a()},[r]),e.jsx(P,{mih:"100vh",children:e.jsx(be,{w:"md",miw:400,children:j?e.jsx(Re,{hostKey:t,ChangeHost:w,setHostEdit:n}):e.jsxs(e.Fragment,{children:[e.jsxs(_e,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx(h,{size:"lg",fw:500,children:m?e.jsx(l,{id:"BL4vL0"}):e.jsx(l,{id:"qJ5FUT"})}),m?e.jsx(ze,{}):e.jsx(Ae,{}),e.jsx(Oe,{loginMode:m,setMode:g})]}),e.jsx(Fe,{hostname:u,toggleHostEdit:n})]})})})}export{qe as default};
