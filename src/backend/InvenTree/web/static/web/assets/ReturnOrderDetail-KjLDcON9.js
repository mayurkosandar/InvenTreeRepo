import{r as d,i as t,j as r,er as U,ci as z,cT as q,Z as J,ad as X,bI as _,S as $}from"./vendor-BnaqX2_l.js";import{A as ee}from"./AdminButton-GD-Bfrm9.js";import{P as w}from"./PrimaryActionButton-DmbHLQKT.js";import{u as te,S as re,R as se,a as ie,I as oe,P as ne}from"./InvenTreeTable-rEa-i3pt.js";import{I as ae,D as E,a as le}from"./InstanceDetail-DvLVYRQt.js";import{D as de,N as ce}from"./NotesPanel-Dh1SrbjV.js";import{B as ue,O as me,E as pe,a as _e,H as he,C as ye}from"./ActionDropdown-D1A3arjv.js";import{C as be,S as G}from"./BaseContext-CH9A7-TB.js";import{P as xe}from"./PageDetail-Ct_zKLxm.js";import{A as fe}from"./AttachmentPanel-Ct80LGG4.js";import{P as ge}from"./PanelGroup-CKTRVRga.js";import{S as ke}from"./Instance-DrUTN1gu.js";import{b as Z}from"./formatters-DBeaC9UC.js";import{a as K,m as i,A as l,U as c,e as C,l as Ce}from"./index-fPzgLVil.js";import{a as W,b as Re,u as V}from"./ReturnOrderForms-CfoSxIhw.js";import{u as y,a as Q,b as je,A as Se,c as Ie}from"./UseForm-DwZIxEnj.js";import{u as Ae}from"./UseInstance-DbDyyJjp.js";import{u as Y}from"./UseStatusCodes-CE5Vxrbg.js";import{E as Fe}from"./ExtraLineItemTable-BjFa9xNb.js";import{a as Pe,S as B,R as De,i as H,N as Ne,L as Oe}from"./ColumnRenderers-6jyK6a0i.js";import"./DesktopAppView-CAvOv5f4.js";import"./navigation-B-mN4luC.js";import"./dayjs.min-DlCiWWGX.js";import"./YesNoButton-W51do83Q.js";import"./GenericErrorPage-BDqvbBMU.js";import"./NotFound-Dr2EC1Qm.js";import"./PermissionDenied-BHX44oqK.js";import"./PageTitle-AnZP781e.js";import"./AttachmentLink-BJMgqQK8.js";import"./ApiIcon-Bqf-O7I2.js";import"./RemoteComponent-Who-27QQ.js";import"./RemoveRowButton-Dm_wD7jw.js";import"./CommonForms-D6scP564.js";function Ee({orderId:u,order:m,customerId:b,currency:e}){const o=te("return-order-line-item"),n=K(),R=Y({modelType:i.returnorder}),[x,j]=d.useState(0),p=d.useMemo(()=>m.status==R.IN_PROGRESS,[m,R]),L=W({orderId:u,customerId:b,create:!0}),v=W({orderId:u,customerId:b}),S=y({url:l.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:L,initialData:{order:u,price_currency:e},table:o}),h=Q({url:l.return_order_line_list,pk:x,title:t._({id:"vgosWS"}),fields:v,table:o}),f=je({url:l.return_order_line_list,pk:x,title:t._({id:"tpKh8C"}),table:o}),I=d.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),switchable:!1,render:s=>Pe({part:s==null?void 0:s.part_detail})},{accessor:"part_detail.IPN",sortable:!1},{accessor:"part_detail.description",sortable:!1},{accessor:"item_detail.serial",title:t._({id:"VbWX2u"}),switchable:!1,render:s=>s.item_detail.serial&&s.quantity==1?`# ${s.item_detail.serial}`:s.quantity},B({model:i.stockitem,sortable:!1,accessor:"item_detail.status",title:t._({id:"uAQUqI"})}),De({}),B({model:i.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>Z(s.price,{currency:s.price_currency})},H({accessor:"target_date",title:t._({id:"ZmykKo"})}),H({accessor:"received_date",title:t._({id:"J18WDZ"})}),Ne({accessor:"notes"}),Oe({})],[]),A=d.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:re(i.returnorderlineitem)}],[]),F=d.useMemo(()=>[r.jsx(Se,{tooltip:t._({id:"pwb7Yo"}),hidden:!n.hasAddRole(c.return_order),onClick:()=>{S.open()}},"add-line-item"),r.jsx(Ie,{tooltip:t._({id:"ORa4sV"}),icon:r.jsx(U,{}),hidden:!p||!n.hasChangeRole(c.return_order),onClick:()=>{a(o.selectedRecords.filter(s=>!s.received_date)),g.open()},disabled:o.selectedRecords.length==0},"receive-items")],[n,p,u,o.selectedRecords]),[P,a]=d.useState([]),g=Re({orderId:u,items:P,onFormSuccess:s=>o.refreshTable()}),D=d.useCallback(s=>[{hidden:!!(s!=null&&s.received_date)||!p||!n.hasChangeRole(c.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(U,{}),onClick:()=>{a([s]),g.open()}},se({hidden:!n.hasChangeRole(c.return_order),onClick:()=>{j(s.pk),h.open()}}),ie({hidden:!n.hasDeleteRole(c.return_order),onClick:()=>{j(s.pk),f.open()}})],[n,p]);return r.jsxs(r.Fragment,{children:[S.modal,h.modal,f.modal,g.modal,r.jsx(oe,{url:C(l.return_order_line_list),tableState:o,columns:I,props:{params:{order:u,part_detail:!0,item_detail:!0,order_detail:!0},enableSelection:p&&n.hasChangeRole(c.return_order),tableActions:F,tableFilters:A,rowActions:D,modelField:"item",modelType:i.stockitem}})]})}function pt(){var D;const{id:u}=be(),m=K(),b=Ce(),{instance:e,instanceQuery:o,refreshInstance:n,requestStatus:R}=Ae({endpoint:l.return_order_list,pk:u,params:{customer_detail:!0}}),x=d.useMemo(()=>{var s;return e.order_currency||((s=e.customer_detail)==null?void 0:s.currency)||b.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,b]),j=d.useMemo(()=>{var O;if(o.isFetching)return r.jsx(z,{});const s=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),icon:"customer",copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:i.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:i.returnorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:i.returnorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],N=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var k;return(e==null?void 0:e.order_currency)??((k=e==null?void 0:e.customer_detail)==null?void 0:k.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var k;return Z(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)??((k=e==null?void 0:e.customer_detail)==null?void 0:k.currency)})}}],T=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"link",model:i.contact,link:!1,name:"contact",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code}],M=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar",copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}];return r.jsxs(ae,{children:[r.jsxs(q,{children:[r.jsx(q.Col,{span:4,children:r.jsx(de,{appRole:c.purchase_order,apiPath:l.company_list,src:(O=e.customer_detail)==null?void 0:O.image,pk:e.customer})}),r.jsx(q.Col,{span:8,children:r.jsx(E,{fields:s,item:e})})]}),r.jsx(E,{fields:N,item:e}),r.jsx(E,{fields:T,item:e}),r.jsx(E,{fields:M,item:e})]})},[e,o]),p=d.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(J,{}),content:j},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(X,{}),content:r.jsxs(_,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(_.Item,{value:"line-items",children:[r.jsx(_.Control,{children:r.jsx(G,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(_.Panel,{children:r.jsx(Ee,{orderId:e.pk,order:e,customerId:e.customer,currency:x})})]},"lineitems"),r.jsxs(_.Item,{value:"extra-items",children:[r.jsx(_.Control,{children:r.jsx(G,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(_.Panel,{children:r.jsx(Fe,{endpoint:l.return_order_extra_line_list,orderId:e.pk,currency:x,role:c.return_order})})]},"extraitems")]})},fe({model_type:i.returnorder,model_id:e.pk}),ce({model_type:i.returnorder,model_id:e.pk})],[e,u,m]),L=d.useMemo(()=>o.isLoading?[]:[r.jsx(ke,{status:e.status_custom_key,type:i.returnorder,options:{size:"lg"}})],[e,o]),v=V({}),S=V({duplicateOrderId:e.pk}),h=Q({url:l.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:v,onFormSuccess:()=>{n()}}),f=y({url:l.return_order_list,title:t._({id:"mpNlR/"}),fields:S,initialData:{...e,reference:void 0},modelType:i.returnorder,follow:!0}),I=y({url:C(l.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:n,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),A=y({url:C(l.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:n,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),F=y({url:C(l.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:n,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),P=y({url:C(l.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:n,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),a=Y({modelType:i.returnorder}),g=d.useMemo(()=>{const s=m.hasChangeRole(c.return_order),N=s&&(e.status==a.PENDING||e.status==a.ON_HOLD),T=s&&(e.status==a.PENDING||e.status==a.PLACED||e.status==a.IN_PROGRESS),M=s&&(e.status==a.PENDING||e.status==a.IN_PROGRESS||e.status==a.ON_HOLD),O=s&&e.status==a.IN_PROGRESS;return[r.jsx(w,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!N,color:"blue",onClick:()=>I.open()}),r.jsx(w,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!O,color:"green",onClick:()=>P.open()}),r.jsx(ee,{model:i.returnorder,id:e.pk}),r.jsx(ue,{model:i.returnorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),r.jsx(ne,{modelType:i.returnorder,items:[e.pk],enableReports:!0}),r.jsx(me,{tooltip:t._({id:"/IKytX"}),actions:[pe({hidden:!m.hasChangeRole(c.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{h.open()}}),_e({tooltip:t._({id:"oi/3Pq"}),hidden:!m.hasChangeRole(c.return_order),onClick:()=>f.open()}),he({tooltip:t._({id:"20mLBC"}),hidden:!T,onClick:()=>F.open()}),ye({tooltip:t._({id:"tVJk4q"}),hidden:!M,onClick:()=>A.open()})]})]},[m,e,a]);return r.jsxs(r.Fragment,{children:[h.modal,I.modal,A.modal,F.modal,P.modal,f.modal,r.jsx(le,{status:R,loading:o.isFetching,requiredRole:c.return_order,children:r.jsxs($,{gap:"xs",children:[r.jsx(xe,{title:`${t._({id:"Z6ve1w"})}: ${e.reference}`,subtitle:e.description,imageUrl:(D=e.customer_detail)==null?void 0:D.image,badges:L,actions:g,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],editAction:h.open,editEnabled:m.hasChangePermission(i.returnorder)}),r.jsx(ge,{pageKey:"returnorder",panels:p,model:i.returnorder,instance:e,id:e.pk})]})})]})}export{pt as default};
