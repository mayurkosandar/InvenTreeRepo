import{bA as Y,r,i as t,j as a,d1 as H,G as v,by as J,aI as V,ci as X,m as $,Z as z,bk as ee,e8 as te,a1 as ae,ae as se,S as re,bF as oe}from"./vendor-BnaqX2_l.js";import{A as ie}from"./AdminButton-GD-Bfrm9.js";import{I as ne,D as G,a as le}from"./InstanceDetail-DvLVYRQt.js";import{O as ce,E as de,D as pe}from"./ActionDropdown-D1A3arjv.js";import{A as S}from"./ApiIcon-Bqf-O7I2.js";import{N as me}from"./NavigationTree-B_DMouOz.js";import{P as ue}from"./PageDetail-Ct_zKLxm.js";import{P as _e}from"./PanelGroup-CKTRVRga.js";import{a as E,A as b,U as w,e as D,f as R,m as _,d as fe}from"./index-fPzgLVil.js";import{u as be,p as N}from"./PartForms-CscLTjK3.js";import{u as Z,a as K,A as xe,b as ge}from"./UseForm-DwZIxEnj.js";import{u as ye}from"./UseInstance-DbDyyJjp.js";import{Y as L}from"./YesNoButton-W51do83Q.js";import{d as he}from"./formatters-DBeaC9UC.js";import{c as je,n as ke}from"./navigation-B-mN4luC.js";import{u as U,I as B,R as Ce}from"./InvenTreeTable-rEa-i3pt.js";import{a as Pe,D as Q,f as Ie}from"./ColumnRenderers-6jyK6a0i.js";import{d as W,C as ve}from"./BaseContext-CH9A7-TB.js";import{P as we}from"./PartTable-DaVQ6v7O.js";import{S as Fe}from"./StockItemTable-Blig3z9s.js";import"./Instance-DrUTN1gu.js";import"./GenericErrorPage-BDqvbBMU.js";import"./NotFound-Dr2EC1Qm.js";import"./PermissionDenied-BHX44oqK.js";import"./PageTitle-AnZP781e.js";import"./RemoteComponent-Who-27QQ.js";import"./dayjs.min-DlCiWWGX.js";import"./DesktopAppView-CAvOv5f4.js";import"./OrderPartsWizard-BFgDSSVd.js";import"./CompanyForms-yUzzFM8E.js";import"./PurchaseOrderForms-DPVzsVCo.js";import"./RemoveRowButton-Dm_wD7jw.js";import"./UseGenerator-DOw_SLei.js";import"./UsePlaceholder-Dc_Ugorx.js";function Te({record:d,template:s,canEdit:m}){const{hovered:f,ref:g}=H(),i=r.useMemo(()=>{var l;return(l=d.parameters)==null?void 0:l.find(j=>j.template==s.pk)},[d.parameters,s]),e=[],h=r.useMemo(()=>{let l=i==null?void 0:i.data;return s!=null&&s.checkbox&&l!=null&&(l=a.jsx(L,{value:i.data})),l},[i,s]);if(s.units&&i&&i.data_numeric&&i.data_numeric!=i.data){const l=he(i.data_numeric,{digits:15});e.push(`${l} [${s.units}]`)}return f&&m&&e.push(t._({id:"cwMTjO"})),a.jsx("div",{children:a.jsx(v,{grow:!0,ref:g,justify:"space-between",children:a.jsx(v,{grow:!0,children:a.jsx(Ie,{value:h??"-",extra:e,icon:f&&m?"edit":"info",title:s.name})})})})}function Se({categoryId:d}){const s=U("parametric-parts"),m=E(),f=W(),g=Y({queryKey:["category-parameters",d],queryFn:async()=>fe.get(D(b.part_parameter_template_list),{params:{category:d}}).then(c=>c.data).catch(c=>[]),refetchOnMount:!0}),[i,e]=r.useState(0),[h,l]=r.useState(0),[j,C]=r.useState(0),x=be({editTemplate:!1}),k=Z({url:b.part_parameter_list,title:t._({id:"iwRvX8"}),fields:r.useMemo(()=>({...x}),[x]),focus:"data",onFormSuccess:c=>{P(i,c)},initialData:{part:i,template:h}}),n=K({url:b.part_parameter_list,title:t._({id:"ZqLOh/"}),pk:j,fields:r.useMemo(()=>({...x}),[x]),focus:"data",onFormSuccess:c=>{P(i,c)}}),P=r.useCallback((c,o)=>{const u=s.records,p=u.findIndex(I=>I.pk==c);if(p<0){s.refreshTable();return}const F=u[p].parameters.findIndex(I=>I.pk==o.pk);F<0?u[p].parameters.push(o):u[p].parameters[F]=o,s.setRecords(u)},[s.records]),T=r.useMemo(()=>(g.data??[]).map(o=>{let u=o.name;return o.units&&(u+=` [${o.units}]`),{accessor:`parameter_${o.pk}`,title:u,sortable:!0,extra:{template:o.pk},render:p=>a.jsx(Te,{record:p,template:o,canEdit:m.hasChangeRole(w.part)})}}),[m,g.data]),A=r.useCallback((c,o)=>{var p;l(c),e(o.pk);const u=(p=o.parameters)==null?void 0:p.find(F=>F.template==c);u?(C(u.pk),n.open()):k.open()},[]),y=r.useMemo(()=>[{name:"active",label:t._({id:"F6pfE9"}),description:t._({id:"xqUGVc"})},{name:"locked",label:t._({id:"G2fuEb"}),description:t._({id:"tB/dWJ"})},{name:"assembly",label:t._({id:"WL36Yh"}),description:t._({id:"IxF0Eq"})}],[]),M=r.useMemo(()=>[...[{accessor:"name",sortable:!0,switchable:!1,noWrap:!0,render:o=>Pe({part:o})},Q({}),{accessor:"IPN",sortable:!0},{accessor:"total_in_stock",sortable:!0}],...T],[T]);return a.jsxs(a.Fragment,{children:[k.modal,n.modal,a.jsx(B,{url:D(b.part_list),tableState:s,columns:M,props:{enableDownload:!1,tableFilters:y,params:{category:d,cascade:!0,category_detail:!0,parameters:!0},onCellClick:({event:c,record:o,index:u,column:p,columnIndex:F})=>{var I,O;if(je(c),(O=(I=p==null?void 0:p.accessor)==null?void 0:I.toString())!=null&&O.startsWith("parameter_"))A(p.extra.template,o);else if(o!=null&&o.pk){const q=R(_.part,o.pk);ke(q,f,c)}}}})]})}function Ae({parentId:d}){const s=U("partcategory"),m=E(),f=r.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1,render:n=>a.jsxs(v,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[a.jsxs(v,{gap:"xs",wrap:"nowrap",children:[n.icon&&a.jsx(S,{name:n.icon}),n.name]}),a.jsx(v,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:n.starred&&a.jsx(J,{label:t._({id:"mUyvRx"}),children:a.jsx(V,{color:"green",size:16})})})]})},Q({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,render:n=>a.jsx(L,{value:n.structural})},{accessor:"part_count",sortable:!0}],[]),g=r.useMemo(()=>[{name:"cascade",label:t._({id:"NgZniC"}),description:t._({id:"Tt3/Pp"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"kHkg2b"})},{name:"starred",label:t._({id:"7VIaU3"}),description:t._({id:"mcDc03"})}],[]),i=N({create:!0}),e=Z({url:b.category_list,title:t._({id:"sIMwJx"}),fields:i,focus:"name",initialData:{parent:d},follow:!0,modelType:_.partcategory,table:s}),[h,l]=r.useState(-1),j=N({create:!1}),C=K({url:b.category_list,pk:h,title:t._({id:"7fjpj0"}),fields:j,onFormSuccess:n=>s.updateRecord(n)}),x=r.useMemo(()=>{const n=m.hasAddRole(w.part_category);return[a.jsx(xe,{tooltip:t._({id:"5LuNgu"}),onClick:()=>e.open(),hidden:!n},"add-part-category")]},[m]),k=r.useCallback(n=>{const P=m.hasChangeRole(w.part_category);return[Ce({hidden:!P,onClick:()=>{l(n.pk),C.open()}})]},[m]);return a.jsxs(a.Fragment,{children:[e.modal,C.modal,a.jsx(B,{url:D(b.category_list),tableState:s,columns:f,props:{enableDownload:!0,params:{parent:d,top_level:d===void 0?!0:void 0},tableFilters:g,tableActions:x,rowActions:k,modelType:_.partcategory}})]})}function mt(){const{id:d}=ve(),s=r.useMemo(()=>Number.isNaN(Number.parseInt(d||""))?void 0:d,[d]),m=W(),f=E(),[g,i]=r.useState(!1),{instance:e,refreshInstance:h,instanceQuery:l,requestStatus:j}=ye({endpoint:b.category_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),C=r.useMemo(()=>{if(s&&l.isFetching)return a.jsx(X,{});const y=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>a.jsxs(v,{gap:"xs",children:[e.icon&&a.jsx(S,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"o8hZ41"}),model:_.partcategory,hidden:!(e!=null&&e.parent)},{type:"boolean",name:"starred",icon:"notification",label:t._({id:"7VIaU3"})}],M=[{type:"text",name:"part_count",label:t._({id:"pmRbKZ"}),icon:"part",value_formatter:()=>(e==null?void 0:e.part_count)||"0"},{type:"text",name:"subcategories",label:t._({id:"7lonqg"}),icon:"sitemap",hidden:!(e!=null&&e.subcategories)},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:t._({id:"XLVNTv"}),model:_.stocklocation,hidden:!e.parent_default_location||e.default_location},{type:"link",name:"default_location",label:t._({id:"QC5Msb"}),model:_.stocklocation,hidden:!e.default_location}];return a.jsxs(ne,{children:[s&&(e!=null&&e.pk)?a.jsx(G,{item:e,fields:y}):a.jsx($,{children:t._({id:"PFKWrQ"})}),s&&(e==null?void 0:e.pk)&&a.jsx(G,{item:e,fields:M})]})},[e,l]),x=K({url:b.category_list,pk:s,title:t._({id:"7fjpj0"}),fields:N({}),onFormSuccess:h}),k=r.useMemo(()=>[{value:0,display_name:t._({id:"y6iD6w"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),n=ge({url:b.category_list,pk:s,title:t._({id:"2tjyh5"}),fields:{delete_parts:{label:t._({id:"PJYQQn"}),description:t._({id:"ZqK0DP"}),choices:k,field_type:"choice"},delete_child_categories:{label:t._({id:"QgH9YK"}),description:t._({id:"ISGGrw"}),choices:k,field_type:"choice"}},onFormSuccess:()=>{e.parent?m(R(_.partcategory,e.parent)):m("/part/")}}),P=r.useMemo(()=>[a.jsx(ie,{model:_.partcategory,id:e.pk},"admin"),a.jsx(ce,{tooltip:t._({id:"O/o81A"}),actions:[de({hidden:!s||!f.hasChangeRole(w.part_category),tooltip:t._({id:"7fjpj0"}),onClick:()=>x.open()}),pe({hidden:!s||!f.hasDeleteRole(w.part_category),tooltip:t._({id:"2tjyh5"}),onClick:()=>n.open()})]},"category-actions")],[s,f,e.pk]),T=r.useMemo(()=>[{name:"details",label:t._({id:"wp9B4i"}),icon:a.jsx(z,{}),content:C},{name:"subcategories",label:t._({id:"7lonqg"}),icon:a.jsx(ee,{}),content:a.jsx(Ae,{parentId:s})},{name:"parts",label:t._({id:"pmRbKZ"}),icon:a.jsx(te,{}),content:a.jsx(we,{props:{params:{category:s}}})},{name:"stockitem",label:t._({id:"Jbck4N"}),icon:a.jsx(ae,{}),hidden:!s,content:a.jsx(Fe,{params:{category:s},allowAdd:!1,tableName:"category-stockitems"})},{name:"parameters",label:t._({id:"TxrNvj"}),icon:a.jsx(se,{}),content:a.jsx(Se,{categoryId:s})}],[e,s]),A=r.useMemo(()=>[{name:t._({id:"pmRbKZ"}),url:"/part"},...(e.path??[]).map(y=>({name:y.name,url:R(_.partcategory,y.pk),icon:y.icon?a.jsx(S,{name:y.icon}):void 0}))],[e]);return a.jsxs(a.Fragment,{children:[x.modal,n.modal,a.jsx(le,{status:j,loading:s?l.isFetching:!1,requiredRole:w.part_category,children:a.jsxs(re,{gap:"xs",children:[a.jsx(oe,{visible:l.isFetching}),a.jsx(me,{modelType:_.partcategory,title:t._({id:"2GkbLI"}),endpoint:b.category_tree,opened:g,onClose:()=>{i(!1)},selectedId:e==null?void 0:e.pk}),a.jsx(ue,{title:t._({id:"QXANxH"}),subtitle:e==null?void 0:e.name,icon:(e==null?void 0:e.icon)&&a.jsx(S,{name:e==null?void 0:e.icon}),breadcrumbs:A,breadcrumbAction:()=>{i(!0)},actions:P,editAction:x.open,editEnabled:f.hasChangePermission(_.partcategory)}),a.jsx(_e,{pageKey:"partcategory",panels:T,model:_.partcategory,instance:e,id:e.pk??null})]})})]})}export{mt as default};
