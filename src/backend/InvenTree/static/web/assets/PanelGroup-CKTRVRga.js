import{j as n,S as I,r as u,bA as A,J as T,bH as y,by as k,bz as v,d7 as F,d8 as M,bB as U}from"./vendor-BnaqX2_l.js";import{l as w,e as G,A as B,d as z,u as L,w as $}from"./index-fPzgLVil.js";import{c as q,n as H}from"./navigation-B-mN4luC.js";import{A as D}from"./ApiIcon-Bqf-O7I2.js";import{R as J,P as Q,u as X}from"./RemoteComponent-Who-27QQ.js";import{g as O,h as C,b as V,d as W,C as Y,r as E,S as Z,j as K}from"./BaseContext-CH9A7-TB.js";function ee({pluginFeature:s,pluginContext:i}){return n.jsx(I,{gap:"xs",children:n.jsx(J,{source:s.source,defaultFunctionName:"renderPanel",context:i})})}function ne({instance:s,model:i,id:r}){const o=w(),x=u.useMemo(()=>o.isSet("ENABLE_PLUGINS_INTERFACE"),[o]),{data:l}=A({enabled:x&&!!i&&r!==void 0,queryKey:["custom-plugin-panels",i,r],queryFn:async()=>{if(!x||!i)return Promise.resolve([]);const a=G(B.plugin_ui_features_list,void 0,{feature_type:Q.panel});return z.get(a,{params:{target_model:i,target_id:r}}).then(c=>c.data).catch(c=>(console.error("ERR: Failed to fetch plugin panels"),[]))}}),f=X(),d=u.useMemo(()=>({model:i,id:r,instance:s,...f}),[i,r,s,f]);return u.useMemo(()=>(l==null?void 0:l.map(a=>{const c=(a==null?void 0:a.icon)||"ti:plug:outline",m={...d,context:a.context};return{name:a.key,pluginName:a.plugin_name,label:a.title,icon:n.jsx(D,{name:c}),content:n.jsx(ee,{pluginFeature:a,pluginContext:m})}}))??[],[l,d])}function ae({pageKey:s,panels:i,onPanelChange:r,selectedPanel:o,instance:x,model:l,id:f,collapsible:d=!0}){const h=L(),a=V(),c=W(),{panel:m}=Y(),[j,_]=u.useState(!0),g=ne({model:l,instance:x,id:f}),P=u.useMemo(()=>{const e=[...i];return g==null||g.forEach(t=>{let b=t.name;e.find(R=>R.name===b)&&(b=$(`${t.pluginName}-${t.name}`)),e.push({...t,name:b})}),e},[i,g]),p=u.useMemo(()=>P.filter(e=>!e.hidden&&!e.disabled),[P]),S=u.useCallback((e,t)=>{if(t&&(t!=null&&t.ctrlKey||t!=null&&t.shiftKey)){const b=`${a.pathname}/../${e}`;q(t),H(b,c,t)}else c(`../${e}`);h.setLastUsedPanel(s)(e),e&&r&&r(e)},[p,c,a,r]);u.useEffect(()=>{o&&o!==m&&S(o)},[o,m]);const N=u.useMemo(()=>{var e;return p.findIndex(t=>t.name===m)===-1?((e=p[0])==null?void 0:e.name)??"":m??""},[p,m]);return n.jsx(E,{label:`PanelGroup-${s}`,children:n.jsx(T,{p:"sm",radius:"xs",shadow:"xs","aria-label":`${s}`,children:n.jsxs(y,{value:N,orientation:"vertical",keepMounted:!1,"aria-label":`panel-group-${s}`,children:[n.jsxs(y.List,{justify:"left","aria-label":`panel-tabs-${s}`,children:[P.map(e=>!e.hidden&&n.jsx(k,{label:e.label??e.name,disabled:j,position:"right",children:n.jsx(y.Tab,{p:"xs",value:e.name,leftSection:e.icon,hidden:e.hidden,disabled:e.disabled,style:{cursor:e.disabled?"unset":"pointer"},onClick:t=>S(e.name,t),children:j&&e.label},`panel-label-${e.name}`)},e.name)),d&&n.jsx(v,{style:{paddingLeft:"10px"},onClick:()=>_(!j),variant:"transparent",size:"md",children:j?n.jsx(F,{opacity:.5}):n.jsx(M,{opacity:.5})})]}),P.map(e=>!e.hidden&&n.jsx(y.Panel,{value:e.name,"aria-label":`nav-panel-${$(`${s}-${e.name}`)}`,p:"sm",style:{overflowX:"scroll",width:"100%"},children:n.jsxs(I,{gap:"md",children:[e.showHeadline!==!1&&n.jsxs(n.Fragment,{children:[n.jsx(Z,{size:"xl",children:e.label}),n.jsx(U,{})]}),n.jsx(E,{label:`PanelContent-${e.name}`,children:e.content})]})},`panel-${e.name}`))]})})})}function te({pageKey:s,selectedPanel:i,panels:r}){const o=L(x=>{var d,h;const l=i||x.lastUsedPanels[s]||((d=r[0])==null?void 0:d.name);return r.findIndex(a=>a.name===l&&!a.disabled&&!a.hidden)===-1?((h=r.find(a=>!a.disabled&&!a.hidden))==null?void 0:h.name)||"":l});return n.jsx(K,{to:o,replace:!0})}function de(s){return n.jsxs(O,{children:[n.jsx(C,{index:!0,element:n.jsx(te,{...s})}),n.jsx(C,{path:"/:panel/*",element:n.jsx(ae,{...s})})]})}export{de as P};
