import{r as o,i as t,j as e,az as z,es as C,bM as R,s as B,x as A,G as m,bw as G,cx as V,m as D,bz as Q,et as U,bE as H,cT as g,J as I,S as k,bB as w,bG as N}from"./vendor-BnaqX2_l.js";import{d as P,T as u,S as f,G as q}from"./BaseContext-CH9A7-TB.js";import{a as L,M as E,d as _,e as F,x as v,A as Z,D as J}from"./index-fPzgLVil.js";import{P as O}from"./PageTitle-AnZP781e.js";import{c as X}from"./UseForm-DwZIxEnj.js";import{R as K}from"./Instance-DrUTN1gu.js";import{u as W,h as Y,I as $}from"./InvenTreeTable-rEa-i3pt.js";import"./dayjs.min-DlCiWWGX.js";import"./ApiIcon-Bqf-O7I2.js";import"./navigation-B-mN4luC.js";import"./DesktopAppView-CAvOv5f4.js";import"./ActionDropdown-D1A3arjv.js";function ee({records:l,onItemsSelected:c,onItemsDeleted:x}){const p=P(),d=L(),r=W("barcode-scan-results","id"),h=o.useMemo(()=>[{accessor:"instance",title:t._({id:"HX5SVx"}),sortable:!1,switchable:!1,render:n=>n.instance?e.jsx(K,{model:n.model,instance:n.instance}):"-"},{accessor:"model",title:t._({id:"scu3wk"}),sortable:!1},{accessor:"barcode",title:t._({id:"ap+FLU"}),sortable:!1},{accessor:"timestamp",title:t._({id:"8TMaZI"}),sortable:!1,render:n=>{var s;return(s=n.timestamp)==null?void 0:s.toLocaleString()}}],[]),b=o.useCallback(n=>{var a;const s=[];return n.model&&n.pk&&n.instance&&s.push(Y({title:t._({id:"Go4fl6"}),modelId:(a=n.instance)==null?void 0:a.pk,modelType:n.model,navigate:p,hidden:!d.hasViewPermission(n.model)})),s},[]),j=o.useMemo(()=>[e.jsx(X,{disabled:!r.hasSelectedRecords,icon:e.jsx(z,{}),color:"red",tooltip:t._({id:"QZQ+5V"}),onClick:()=>{x(r.selectedIds),r.clearSelectedRecords()}})],[r.hasSelectedRecords,r.selectedIds]);return o.useEffect(()=>{c(r.selectedIds)},[r.selectedIds]),e.jsx(e.Fragment,{children:e.jsx($,{tableState:r,tableData:l,columns:h,props:{enableFilters:!1,enableSelection:!0,enablePagination:!1,enableSearch:!1,enableRefresh:!1,rowActions:b,tableActions:j}})})}function xe(){const[l,c]=C([]),[x,p]=R({key:"scan-history",defaultValue:[]}),[d,r]=o.useState([]),h=o.useCallback(s=>{if(!s.model||!s.pk)return;if(l.find(i=>i.model==s.model&&i.pk==s.pk)){B({label:t._({id:"euc6Ns"}),message:t._({id:"6IETQS"}),color:"orange"});return}const a=E[s.model];_.get(F(a.api_endpoint,s.pk)).then(i=>{s.instance=i.data,c.append(s)}).catch(i=>{v({error:i,title:t._({id:"DFEq8c"}),message:t._({id:"beMwe+"})})})},[_,l]),b=o.useCallback(s=>{_.post(F(Z.barcode),{barcode:s}).then(a=>{var y,M;const i=(a==null?void 0:a.data)??{};let T=!1;for(const S of Object.keys(E))(y=i[S])!=null&&y.pk&&(T=!0,h({id:A(),barcode:s,data:i,timestamp:new Date,source:"scan",model:S,pk:(M=i[S])==null?void 0:M.pk}));T||c.append({id:A(),barcode:s,data:i,timestamp:new Date,source:"scan"})}).catch(a=>{v({error:a,message:t._({id:"I3WmwV"}),title:t._({id:"72IS8c"}),field:"error"})})},[h]);o.useEffect(()=>{l.length!==0&&p(l)},[l]),o.useEffect(()=>{c.setState(x)},[x]);const j=o.useMemo(()=>l.filter(s=>d.includes(s.id)),[d,l]),n=o.useMemo(()=>{const s=new Set(j.map(a=>a.model));return s.size===0?e.jsxs(m,{gap:0,children:[e.jsx(G,{color:"orange"}),e.jsx(u,{id:"dQStih"})]}):s.size>1?e.jsxs(m,{gap:0,children:[e.jsx(V,{color:"orange"}),e.jsx(u,{id:"Oik3bo"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{fz:"sm",c:"dimmed",children:e.jsx(u,{id:"oGDiXN"})}),e.jsx(m,{children:e.jsx(Q,{onClick:J,title:t._({id:"wBMjJ2"}),variant:"default",children:e.jsx(U,{})})})]})},[j]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:t._({id:"kSFUZe"})}),e.jsx(m,{justify:"space-between",children:e.jsx(m,{justify:"left",children:e.jsx(f,{size:"xl",children:e.jsx(u,{id:"kSFUZe"})})})}),e.jsx(H,{h:"md"}),e.jsxs(g,{maw:"100%",children:[e.jsxs(g.Col,{span:4,children:[e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(f,{size:"lg",children:t._({id:"n5kv5D"})}),e.jsx(w,{}),e.jsx(q,{onScan:b})]})}),e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(f,{size:"lg",children:t._({id:"bwRvnp"})}),e.jsx(w,{}),d.length===0?e.jsx(N,{title:t._({id:"65vtJ8"}),color:"blue",children:e.jsx(u,{id:"mB/UHi"})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx(u,{id:"sQhVFe",values:{0:d.length}})}),n]})]})})]}),e.jsx(g.Col,{span:8,children:e.jsx(I,{p:"sm",shadow:"xs",children:e.jsxs(k,{gap:"xs",children:[e.jsx(m,{justify:"space-between",children:e.jsx(f,{size:"lg",children:t._({id:"Ku9qqT"})})}),e.jsx(w,{}),e.jsx(ee,{records:l,onItemsSelected:s=>{r(s)},onItemsDeleted:s=>{const a=l.filter(i=>!s.includes(i.id));c.setState(a),p(a)}})]})})})]})]})}export{xe as default};
