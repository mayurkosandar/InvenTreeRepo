import{r as a,i as n,j as r,b4 as v,d_ as F,d$ as g,bD as u}from"./vendor-BnaqX2_l.js";import{R as S}from"./RemoveRowButton-Dm_wD7jw.js";import{u as M,S as h}from"./UseForm-DwZIxEnj.js";import{a as A,P as T}from"./ColumnRenderers-6jyK6a0i.js";import{e as k,A as y,m as q}from"./index-fPzgLVil.js";function $({duplicateOrderId:e}){return a.useMemo(()=>{const t={reference:{},description:{},customer:{disabled:e!=null,filters:{is_customer:!0,active:!0}},customer_reference:{},project_code:{},order_currency:{},target_date:{},link:{},contact:{icon:r.jsx(v,{}),adjustFilters:i=>({...i.filters,company:i.data.customer})},address:{icon:r.jsx(F,{}),adjustFilters:i=>({...i.filters,company:i.data.customer})},responsible:{icon:r.jsx(g,{})}};return e&&(t.duplicate={children:{order_id:{hidden:!0,value:e},copy_lines:{},copy_extra_lines:{}}}),t},[e])}function D({customerId:e,orderId:t,create:i}){return a.useMemo(()=>({order:{filters:{customer_detail:!0},disabled:!0,value:i?t:void 0},part:{filters:{active:!0,salable:!0}},reference:{},quantity:{},sale_price:{},sale_price_currency:{},target_date:{},notes:{},link:{}}),[])}function C({props:e,record:t,sourceLocation:i}){var o,f,s,d;const m=a.useMemo(()=>({field_type:"related field",api_url:k(y.stock_item_list),model:q.stockitem,filters:{available:!0,part_detail:!0,location_detail:!0,location:i,cascade:i?!0:void 0,part:t.part},value:e.item.stock_item,name:"stock_item",onValueChange:(c,x)=>{var b;if(e.changeFn(e.idx,"stock_item",c),x){const j=x.quantity-x.allocated,p=t.quantity-t.allocated;let l=((b=e.item)==null?void 0:b.quantity)??0;l=Math.max(l,p),l=Math.min(l,j),l!=e.item.quantity&&e.changeFn(e.idx,"quantity",l)}}}),[i,t,e]),_=a.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:e.item.quantity,onValueChange:c=>{e.changeFn(e.idx,"quantity",c)}}),[e]);return r.jsxs(u.Tr,{children:[r.jsx(u.Td,{children:r.jsx(A,{part:t.part_detail})}),r.jsx(u.Td,{children:r.jsx(T,{value:t.allocated,maximum:t.quantity,progressLabel:!0})}),r.jsx(u.Td,{children:r.jsx(h,{fieldName:"stock_item",fieldDefinition:m,error:(f=(o=e.rowErrors)==null?void 0:o.stock_item)==null?void 0:f.message})}),r.jsx(u.Td,{children:r.jsx(h,{fieldName:"quantity",fieldDefinition:_,error:(d=(s=e.rowErrors)==null?void 0:s.quantity)==null?void 0:d.message})}),r.jsx(u.Td,{children:r.jsx(S,{onClick:()=>e.removeFn(e.idx)})})]},`table-row-${e.idx}-${t.pk}`)}function P({orderId:e,shipmentId:t,lineItems:i,onFormSuccess:m}){const[_,o]=a.useState(null);a.useEffect(()=>{o(null)},[e,t,i]);const f=a.useMemo(()=>({source_location:{exclude:!0,required:!1,field_type:"related field",api_url:k(y.stock_location_list),model:q.stocklocation,label:n._({id:"/00Ond"}),description:n._({id:"IArqwk"}),onValueChange:s=>{o(s)}},items:{field_type:"table",value:[],headers:[n._({id:"vgP+9p"}),n._({id:"A/ybx7"}),n._({id:"igx8Og"}),n._({id:"VbWX2u"})],modelRenderer:s=>{const d=i.find(c=>c.pk==s.item.line_item)??{};return r.jsx(C,{props:s,record:d,sourceLocation:_},`table-row-${s.idx}-${d.pk}`)}},shipment:{filters:{shipped:!1,order_detail:!0,order:e}}}),[e,t,i,_]);return M({title:n._({id:"L1LMmH"}),url:y.sales_order_allocate,pk:e,fields:f,onFormSuccess:m,successMessage:n._({id:"23SrHL"}),size:"80%",initialData:{items:i.map(s=>({line_item:s.pk,quantity:0,stock_item:null}))}})}function V({itemId:e,orderId:t}){return a.useMemo(()=>({line_item:{value:e,hidden:!0},quantity:{},serial_numbers:{},shipment:{filters:{order_detail:!0,order:t,shipped:!1}}}),[e,t])}function B({pending:e}){return a.useMemo(()=>({order:{disabled:!0},reference:{},shipment_date:{hidden:e??!0},delivery_date:{hidden:e??!0},tracking_number:{},invoice_number:{},link:{}}),[e])}function U({shipmentId:e}){return a.useMemo(()=>({shipment_date:{},tracking_number:{},invoice_number:{},link:{}}),[e])}function H({orderId:e,shipment:t}){return a.useMemo(()=>({item:{disabled:!0},quantity:{},shipment:{disabled:!!(t!=null&&t.shipment_date),hidden:!e,filters:{order:e,shipped:!1}}}),[e,t])}export{H as a,D as b,V as c,P as d,B as e,U as f,$ as u};
