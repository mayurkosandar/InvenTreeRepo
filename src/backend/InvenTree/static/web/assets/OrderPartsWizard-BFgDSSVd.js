import{r as l,j as e,S as M,G as b,bE as G,bB as H,cp as T,J as q,bW as J,by as y,bz as v,e0 as L,e1 as O,cs as U,i,I as Q,bG as D,d as V,s as Y,a6 as K}from"./vendor-BnaqX2_l.js";import{Y as N}from"./InvenTreeTable-rEa-i3pt.js";import{e as g,A as C,m as z}from"./index-fPzgLVil.js";import{a as X}from"./CompanyForms-yUzzFM8E.js";import{u as $}from"./PurchaseOrderForms-DPVzsVCo.js";import{u as A,S as I,A as B,c as Z}from"./UseForm-DwZIxEnj.js";import{S as R,r as ee,J as P}from"./BaseContext-CH9A7-TB.js";import{a as re}from"./ColumnRenderers-6jyK6a0i.js";import{R as se}from"./RemoveRowButton-Dm_wD7jw.js";function te({currentStep:t,steps:r,onSelectStep:o}){if(!r||r.length==0)return null;const x=l.useCallback(c=>!r||r.length<=1?!1:Math.abs(c-t)==1,[t,r]),s=t>0,f=t<r.length-1;return e.jsx(J,{p:"xs",withBorder:!0,children:e.jsxs(b,{justify:"space-between",gap:"xs",wrap:"nowrap",children:[e.jsx(y,{label:r[t-1],position:"top",disabled:!s,children:e.jsx(v,{variant:"transparent",onClick:()=>o(t-1),disabled:!s,children:e.jsx(L,{})})}),e.jsx(O,{active:t,onStepClick:c=>o(c),iconSize:20,size:"xs",children:r.map((c,_)=>e.jsx(O.Step,{label:c,"aria-label":`wizard-step-${_}`,allowStepSelect:x(_)},c))}),f?e.jsx(y,{label:r[t+1],position:"top",disabled:!f,children:e.jsx(v,{variant:"transparent",onClick:()=>o(t+1),disabled:!f,children:e.jsx(U,{})})}):e.jsx(y,{label:i._({id:"bD8I7O"}),position:"top",children:e.jsx(v,{color:"green",variant:"transparent",children:e.jsx(Q,{})})})]})})}function ae({title:t,currentStep:r,steps:o,children:x,opened:s,onClose:f,onNextStep:c,onPreviousStep:_}){const h=l.useMemo(()=>e.jsxs(M,{gap:"xs",style:{width:"100%"},children:[e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"space-between",grow:!0,preventGrowOverflow:!1,children:[e.jsx(R,{size:"xl",children:t}),e.jsx(te,{currentStep:r,steps:o,onSelectStep:n=>{n<r?_==null||_():c==null||c()}}),e.jsx(G,{})]}),e.jsx(H,{})]}),[t,r,o]);return e.jsx(T,{position:"bottom",size:"75%",title:h,withCloseButton:!0,closeOnEscape:!1,closeOnClickOutside:!1,styles:{header:{width:"100%"},title:{width:"100%"}},opened:s,onClose:f,children:e.jsxs(ee,{label:"wizard-drawer",children:[e.jsx(q,{p:"md"}),x]})})}function ie(t){const[r,o]=l.useState(0),[x,s]=l.useState(!1),[f,c]=l.useState(null),[_,h]=l.useState(null),n=l.useCallback(()=>{c(null),h(null)},[]);l.useEffect(()=>{x&&(o(0),n())},[x]);const u=l.useCallback(()=>{s(!0)},[]),p=l.useCallback(()=>{s(!1)},[]),d=l.useCallback(()=>{t.canStepForward&&!t.canStepForward(r)||t.steps&&r<t.steps.length-1&&(o(r+1),n())},[r,t.canStepForward]),m=l.useCallback(()=>{t.canStepBackward&&!t.canStepBackward(r)||r>0&&(o(r-1),n())},[r,t.canStepBackward]),k=l.useMemo(()=>t.renderStep(r),[x,r,t.renderStep]);return{currentStep:r,opened:x,clearError:n,error:f,setError:c,errorDetail:_,setErrorDetail:h,openWizard:u,closeWizard:p,nextStep:d,previousStep:m,wizard:e.jsx(ae,{title:t.title,currentStep:r,steps:t.steps,opened:x,onClose:p,onNextStep:d,onPreviousStep:m,children:e.jsxs(M,{gap:"xs",children:[f&&e.jsx(D,{color:"red",title:f,icon:e.jsx(V,{}),children:_}),k]})})}}function le({records:t,onRemovePart:r,onSelectSupplierPart:o,onSelectPurchaseOrder:x}){var m,k,F;const[s,f]=l.useState(null),c=$({supplierId:(m=s==null?void 0:s.supplier_part)==null?void 0:m.supplier}),_=A({url:g(C.purchase_order_list),title:i._({id:"00xEJ9"}),fields:c,successMessage:i._({id:"x3sha9"}),onFormSuccess:a=>{x(s==null?void 0:s.part.pk,a)}}),h=X({partId:s==null?void 0:s.part.pk}),n=A({url:g(C.supplier_part_list),title:i._({id:"wvbkAd"}),fields:h,successMessage:i._({id:"LjPQ/X"}),onFormSuccess:a=>{o(s==null?void 0:s.part.pk,a)}}),u=l.useMemo(()=>{var a,j;return{order:{value:(a=s==null?void 0:s.purchase_order)==null?void 0:a.pk,disabled:!0},part:{value:(j=s==null?void 0:s.supplier_part)==null?void 0:j.pk,disabled:!0},reference:{},quantity:{},merge_items:{}}},[s]),p=A({url:g(C.purchase_order_line_list),title:i._({id:"84UAd6"}),fields:u,focus:"quantity",initialData:{order:(k=s==null?void 0:s.purchase_order)==null?void 0:k.pk,part:(F=s==null?void 0:s.supplier_part)==null?void 0:F.pk,quantity:s==null?void 0:s.quantity},onFormSuccess:a=>{r(s==null?void 0:s.part)},successMessage:i._({id:"WdLHOQ"})}),d=l.useMemo(()=>[{accessor:"left_actions",title:" ",width:"1%",render:a=>e.jsx(b,{gap:"xs",wrap:"nowrap",justify:"left",children:e.jsx(se,{onClick:()=>r(a.part)})})},{accessor:"part",title:i._({id:"vgP+9p"}),render:a=>{var j;return e.jsx(y,{label:(j=a.part)==null?void 0:j.description,children:e.jsx(q,{p:"xs",children:e.jsx(re,{part:a.part})})})}},{accessor:"supplier_part",title:i._({id:"nne72x"}),width:"40%",render:a=>{var j,w;return e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(P,{children:e.jsx(I,{fieldName:"supplier_part",hideLabels:!0,error:(j=a.errors)==null?void 0:j.supplier_part,fieldDefinition:{field_type:"related field",api_url:g(C.supplier_part_list),model:z.supplierpart,required:!0,value:(w=a.supplier_part)==null?void 0:w.pk,onValueChange:(E,S)=>{o(a.part.pk,S)},filters:{part:a.part.pk,active:!0,supplier_detail:!0}}})}),e.jsx(B,{tooltip:i._({id:"vCJjUj"}),tooltipAlignment:"top",onClick:()=>{f(a),n.open()}})]})}},{accessor:"purchase_order",title:i._({id:"KxySMG"}),width:"40%",render:a=>{var j,w,E,S;return e.jsxs(b,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(P,{children:e.jsx(I,{fieldName:"purchase_order",hideLabels:!0,fieldDefinition:{field_type:"related field",api_url:g(C.purchase_order_list),model:z.purchaseorder,disabled:!((j=a.supplier_part)!=null&&j.supplier),value:(w=a.purchase_order)==null?void 0:w.pk,filters:{supplier:(E=a.supplier_part)==null?void 0:E.supplier,outstanding:!0},onValueChange:(ne,W)=>{x(a.part.pk,W)}}})}),e.jsx(B,{tooltip:i._({id:"ilPjST"}),tooltipAlignment:"top",disabled:!((S=a.supplier_part)!=null&&S.pk),onClick:()=>{f(a),_.open()}})]})}},{accessor:"right_actions",title:" ",width:"1%",render:a=>{var j,w;return e.jsx(b,{grow:!0,gap:"xs",wrap:"nowrap",justify:"right",children:e.jsx(Z,{onClick:()=>{f(a),p.open()},disabled:!((j=a.supplier_part)!=null&&j.pk)||!a.quantity||!((w=a.purchase_order)!=null&&w.pk),icon:e.jsx(K,{}),tooltip:i._({id:"T0PG4M"}),tooltipAlignment:"top",color:"blue"})})}}],[r]);return t.length===0?e.jsx(D,{color:"red",title:i._({id:"RHAB56"}),children:i._({id:"J6mnho"})}):e.jsxs(e.Fragment,{children:[e.jsx(N,{idAccessor:"part.pk",columns:d,records:t}),_.modal,n.modal,p.modal]})}function je({parts:t}){const[r,o]=l.useState([]),x=l.useCallback(n=>{const u=r.filter(p=>{var d;return((d=p.part)==null?void 0:d.pk)!==n.pk});o(u),u.length===0&&(h.closeWizard(),Y({title:i._({id:"sUQHeO"}),message:i._({id:"s2oix5"}),color:"green"}))},[r]),s=l.useCallback((n,u)=>{const p=[...r];p.forEach((d,m)=>{d.part.pk===n&&(p[m].supplier_part=u)}),o(p)},[r]),f=l.useCallback((n,u)=>{const p=[...r];p.forEach((d,m)=>{d.part.pk===n&&(p[m].purchase_order=u)}),o(p)},[r]),c=l.useCallback(n=>e.jsx(le,{records:r,onRemovePart:x,onSelectSupplierPart:s,onSelectPurchaseOrder:f}),[r]),_=l.useCallback(n=>{if(!(r!=null&&r.length))return h.setError(i._({id:"RHAB56"})),h.setErrorDetail(i._({id:"hqPdIW"})),!1;let u=!0;const p=[...r];return r.forEach((d,m)=>{p[m].errors={supplier_part:d.supplier_part?null:i._({id:"f4INHl"}),quantity:!d.quantity||d.quantity<=0?i._({id:"siOHHM"}):null},Object.values(p[m].errors).some(k=>k)&&(u=!1)}),o(p),u||(h.setError(i._({id:"EG74zf"})),h.setErrorDetail(i._({id:"6FCFII"}))),u},[r]),h=ie({title:i._({id:"3u5ICq"}),steps:[],renderStep:c,canStepForward:_});return l.useEffect(()=>{const n=[];h.opened?(t.filter(u=>u.purchaseable&&u.active).forEach(u=>{n.find(p=>{var d;return((d=p.part)==null?void 0:d.pk)===u.pk})||n.push({part:u,supplier_part:void 0,purchase_order:void 0,quantity:1,errors:{}})}),o(n)):o([])},[h.opened]),h}export{je as O};
