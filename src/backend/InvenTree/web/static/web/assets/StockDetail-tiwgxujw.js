import{i as t,r as n,j as s,bs as Ne,ci as U,bA as ve,G,m as $,by as xe,bC as fe,Z as Ae,s as ye,I as Ve,aB as Oe,bD as B,cT as H,bu as We,em as Ye,bI as P,en as Ge,eo as Le,bk as Je,bG as Qe,a1 as He,a6 as Xe,S as $e}from"./vendor-BnaqX2_l.js";import{a as ee,e as v,A as m,m as r,U as k,l as Te,d as Z,f as X}from"./index-fPzgLVil.js";import{A as Ze}from"./AdminButton-GD-Bfrm9.js";import{u as te,I as se,R as et,a as tt,i as st,Y as at,P as lt}from"./InvenTreeTable-rEa-i3pt.js";import{I as it,D as L,a as ot}from"./InstanceDetail-DvLVYRQt.js";import{D as w}from"./DetailsBadge-CfxzC3Fy.js";import{D as nt,N as rt}from"./NotesPanel-Dh1SrbjV.js";import{B as dt,A as ct,O as ut,a as pt,E as mt,D as _t}from"./ActionDropdown-D1A3arjv.js";import{d as Pe,C as bt,S as je,I as M}from"./BaseContext-CH9A7-TB.js";import{N as kt}from"./NavigationTree-B_DMouOz.js";import{P as ht}from"./PageDetail-Ct_zKLxm.js";import{A as xt}from"./AttachmentPanel-Ct80LGG4.js";import{P as ft}from"./PanelGroup-CKTRVRga.js";import{L as yt}from"./LocateItemButton--RRdFqor.js";import{d as Me,f as ge,S as Re,c as jt,h as gt,i as St,j as It,k as Ct,l as wt,m as vt}from"./Instance-DrUTN1gu.js";import{O as At}from"./OrderPartsWizard-BFgDSSVd.js";import{f as Se,b as Ie}from"./formatters-DBeaC9UC.js";import{b as Tt,c as Pt,d as Ce,S as Mt,e as we,u as Rt,f as Dt,g as Ft,a as qt,h as zt,i as Et}from"./StockItemTable-Blig3z9s.js";import{u as q,A as De,a as Fe,b as qe}from"./UseForm-DwZIxEnj.js";import{u as Bt}from"./UseInstance-DbDyyJjp.js";import{B as Ut}from"./BuildAllocatedStockTable-LHqg9kJJ.js";import{S as Kt}from"./SalesOrderAllocationTable-C1XN-9wZ.js";import{a as Nt,S as Vt,D as ze,N as Ot,i as Ee}from"./ColumnRenderers-6jyK6a0i.js";import{P as Wt}from"./YesNoButton-W51do83Q.js";import{A as Yt}from"./AttachmentLink-BJMgqQK8.js";import{c as Gt}from"./UseFilter-qbbXWiSh.js";import"./DesktopAppView-CAvOv5f4.js";import"./navigation-B-mN4luC.js";import"./dayjs.min-DlCiWWGX.js";import"./GenericErrorPage-BDqvbBMU.js";import"./NotFound-Dr2EC1Qm.js";import"./PermissionDenied-BHX44oqK.js";import"./ApiIcon-Bqf-O7I2.js";import"./PageTitle-AnZP781e.js";import"./RemoteComponent-Who-27QQ.js";import"./CompanyForms-yUzzFM8E.js";import"./PurchaseOrderForms-DPVzsVCo.js";import"./RemoveRowButton-Dm_wD7jw.js";import"./UseGenerator-DOw_SLei.js";import"./UsePlaceholder-Dc_Ugorx.js";import"./SalesOrderForms-CNvk5nqw.js";function Lt({stockItem:c}){var A;const i=te("stock_item_install"),b=ee(),_=Tt({stockItem:c}),y=q({url:v(m.stock_install),pk:c.pk,title:t._({id:"erPDED"}),table:i,successMessage:t._({id:"g+zcGQ"}),fields:_}),[j,g]=n.useState({}),e=Pt(),o=q({url:v(m.stock_uninstall),pk:j.pk,title:t._({id:"q2BZiX"}),table:i,successMessage:t._({id:"ibtYlF"}),fields:e,initialData:{location:c.location??((A=c.part_detail)==null?void 0:A.default_location)}}),I=n.useMemo(()=>[{accessor:"part",switchable:!1,render:p=>Nt({part:p==null?void 0:p.part_detail})},{accessor:"quantity",switchable:!1,render:p=>{let C=p.quantity;return p.serial&&p.quantity==1&&(C=`# ${p.serial}`),C}},{accessor:"batch",switchable:!1},Vt({model:r.stockitem})],[]),h=n.useMemo(()=>{var p;return[s.jsx(De,{tooltip:t._({id:"erPDED"}),onClick:()=>{y.open()},hidden:!b.hasChangeRole(k.stock)||c.is_building||((p=c.part_detail)==null?void 0:p.assembly)!=!0},"install")]},[c,b]),R=n.useCallback(p=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{g(p),o.open()},icon:s.jsx(Ne,{}),hidden:!b.hasChangeRole(k.stock)}],[b]);return s.jsxs(s.Fragment,{children:[y.modal,o.modal,c.pk?s.jsx(se,{url:v(m.stock_item_list),tableState:i,columns:I,props:{tableActions:h,rowActions:R,modelType:r.stockitem,params:{belongs_to:c.pk,part_detail:!0}}}):s.jsx(U,{})]})}function Jt({partId:c,itemId:i}){const b=ee(),_=te("stocktests"),y=Te(),j=n.useMemo(()=>y.isSet("TEST_STATION_DATA"),[y]),{data:g}=ve({queryKey:["stocktesttemplates",c,i],queryFn:async()=>c?Z.get(v(m.part_test_template_list),{params:{part:c,include_inherited:!0,enabled:!0}}).then(a=>a.data).catch(a=>[]):[]});n.useEffect(()=>{_.refreshTable()},[g]);const e=n.useCallback(a=>{const u=g.map(d=>({...d,templateId:d.pk,results:[]}));return a.forEach(d=>{u.find(x=>x.templateId==d.template)||u.push({...d.template_detail,templateId:d.template,results:[]})}),a.sort((d,x)=>d.pk>x.pk?1:-1).forEach(d=>{const x=u.findIndex(T=>T.templateId==d.template);x>=0&&(u[x]={...u[x],...d},u[x].results.push(d))}),u},[c,i,g]),o=n.useMemo(()=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{var x,T;const u=a.enabled??((x=a.template_detail)==null?void 0:x.enabled),d=a.stock_item!=null&&a.stock_item!=i;return s.jsxs(G,{justify:"space-between",wrap:"nowrap",children:[s.jsxs($,{style:{fontStyle:d?"italic":void 0},c:u?void 0:"red",children:[!a.templateId&&"- ",a.test_name??((T=a.template_detail)==null?void 0:T.test_name)]}),s.jsxs(G,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx(xe,{label:t._({id:"isbwWo"}),children:s.jsx(fe,{color:"lightblue",variant:"filled",children:a.results.length})}),d&&s.jsx(xe,{label:t._({id:"yd1WJ/"}),children:s.jsx(Ae,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(fe,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Wt,{value:a.result})},ze({accessor:"description"}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Yt,{attachment:a.attachment}),noContext:!0},Ot({}),Ee({}),{accessor:"user",title:t._({id:"7PzzBU"}),sortable:!1,render:a=>a.user_detail&&s.jsx(Me,{instance:a.user_detail})},{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!j},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!j,render:a=>s.jsx(G,{justify:"space-between",children:Se(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!j,render:a=>s.jsx(G,{justify:"space-between",children:Se(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[i,j]),[I,h]=n.useState(void 0),R=Ce({partId:c,itemId:i,templateId:I,editing:!1}),A=Ce({partId:c,itemId:i,templateId:I,editing:!0}),p=q({url:m.stock_test_result_list,fields:n.useMemo(()=>({...R}),[R]),initialData:{template:I,result:!0},title:t._({id:"VzkBcq"}),table:_,successMessage:t._({id:"VivtT0"})}),[C,D]=n.useState(0),z=Fe({url:m.stock_test_result_list,pk:C,fields:n.useMemo(()=>({...A}),[A]),title:t._({id:"1HKt5e"}),table:_,successMessage:t._({id:"G0v/SO"})}),K=qe({url:m.stock_test_result_list,pk:C,title:t._({id:"381PhV"}),table:_,successMessage:t._({id:"xbuMqN"})}),J=n.useCallback(a=>{Z.post(v(m.stock_test_result_list),{template:a,stock_item:i,result:!0}).then(()=>{_.refreshTable(),ye({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{ye({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[i]),N=n.useCallback(a=>a.stock_item!=null&&a.stock_item!=i?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(Ve,{}),hidden:!a.templateId||(a==null?void 0:a.requires_attachment)||(a==null?void 0:a.requires_value)||a.result,onClick:()=>J(a.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(Oe,{}),hidden:!b.hasAddRole(k.stock)||!a.templateId,onClick:()=>{h(a.templateId),p.open()}},et({tooltip:t._({id:"1HKt5e"}),hidden:!b.hasChangeRole(k.stock)||!a.template_detail,onClick:()=>{D(a.pk),z.open()}}),tt({tooltip:t._({id:"381PhV"}),hidden:!b.hasDeleteRole(k.stock)||!a.template_detail,onClick:()=>{D(a.pk),K.open()}})],[b,i]),E=n.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),Q=n.useMemo(()=>[s.jsx(De,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{h(void 0),p.open()},hidden:!b.hasAddRole(k.stock)},"add-test-result")],[b]),V=n.useMemo(()=>{const a=[...o,{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:u=>s.jsx(st,{actions:N(u)??[]})}];return{allowMultiple:!0,content:({record:u})=>{if(!u||!u.results||u.results.length<2)return null;const d=(u==null?void 0:u.results)??[];return s.jsx(at,{idAccessor:"test",noHeader:!0,columns:a,records:d.slice(0,-1)},u.pk)}}},[]);return s.jsxs(s.Fragment,{children:[p.modal,z.modal,K.modal,s.jsx(se,{url:v(m.stock_test_result_list),tableState:_,columns:o,props:{dataFormatter:e,enablePagination:!1,tableActions:Q,tableFilters:E,rowActions:N,rowExpansion:V,params:{stock_item:i,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Qt({itemId:c}){const i=Pe(),b=te("stock_tracking"),_=Gt(),y=n.useCallback(e=>{const o=(e==null?void 0:e.deltas)??{},I=[{label:t._({id:"igx8Og"}),key:"stockitem",details:o.stockitem_detail&&ge({instance:o.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:o.item_detail&&ge({instance:o.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:o.status&&Re({status:o.status,type:r.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:o.quantity},{label:t._({id:"hp8OtS"}),key:"added",details:o.added},{label:t._({id:"eps54V"}),key:"removed",details:o.removed},{label:t._({id:"vgP+9p"}),key:"part",details:o.part_detail&&jt({instance:o.part_detail,link:!0,navigate:i})},{label:t._({id:"wJijgU"}),key:"location",details:o.location_detail&&gt({instance:o.location_detail,link:!0,navigate:i})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:o.buildorder_detail&&St({instance:o.buildorder_detail,link:!0,navigate:i})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:o.purchaseorder_detail&&It({instance:o.purchaseorder_detail,link:!0,navigate:i})},{label:t._({id:"LozYBo"}),key:"salesorder",details:o.salesorder_detail&&Ct({instance:o.salesorder_detail,link:!0,navigate:i})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:o.returnorder_detail&&wt({instance:o.returnorder_detail,link:!0,navigate:i})},{label:t._({id:"876pfE"}),key:"customer",details:o.customer_detail&&vt({instance:o.customer_detail,link:!0,navigate:i})}];return s.jsx(B,{striped:!0,children:s.jsx(B.Tbody,{children:I.map(h=>h.details&&s.jsxs(B.Tr,{children:[s.jsx(B.Td,{children:s.jsx($,{children:h.label})}),s.jsx(B.Td,{children:h.details})]},h.key))})})},[i]),j=n.useMemo(()=>[{name:"user",label:t._({id:"7PzzBU"}),choices:_.choices,description:t._({id:"FVjW63"})}],[_]),g=n.useMemo(()=>[Ee({switchable:!1}),ze({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:y},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:e=>e.user_detail?Me({instance:e.user_detail}):s.jsx($,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(se,{tableState:b,url:v(m.stock_tracking_list),columns:g,props:{params:{item:c,user_detail:!0},enableDownload:!0,tableFilters:j}})}function Es(){var de,ce,ue,pe,me;const{id:c}=bt(),i=ee(),b=Te(),_=n.useMemo(()=>b.isSet("STOCK_ENABLE_EXPIRY"),[b]),y=Pe(),[j,g]=n.useState(!1),{instance:e,refreshInstance:o,refreshInstancePromise:I,instanceQuery:h,requestStatus:R}=Bt({endpoint:m.stock_item_list,pk:c,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),A=n.useMemo(()=>{var _e,be;const l={...e},f=(e==null?void 0:e.part_detail)??{};if(l.available_stock=Math.max(0,l.quantity-l.allocated),h.isFetching)return s.jsx(U,{});const F=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:r.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!f.IPN},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:r.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:r.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"text",name:"tests",label:t._({id:"Yo+Era"}),icon:"progress",hidden:!(f!=null&&f.testable)},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}],O=[{type:"text",name:"quantity",label:t._({id:"VbWX2u"})},{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial},{type:"text",name:"available_stock",label:t._({id:"csDS2L"}),icon:"stock"},{type:"text",name:"allocated",label:t._({id:"8oSGoC"}),icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],W=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model:r.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:r.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:S=>{var he;let ke=((he=S==null?void 0:S.part_detail)==null?void 0:he.full_name)??(S==null?void 0:S.name);return S.serial&&S.quantity==1&&(ke+=` # ${S.serial}`),ke},icon:"stock",model:r.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:r.stockitem,hidden:!e.parent,model_formatter:S=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:r.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:r.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:r.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:r.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:r.company,hidden:!e.customer}],Y=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!_||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>Ie(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>Ie(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging}];return s.jsxs(it,{children:[s.jsxs(H,{children:[s.jsx(H.Col,{span:4,children:s.jsx(nt,{appRole:k.part,apiPath:m.part_list,src:((_e=e.part_detail)==null?void 0:_e.image)??((be=e==null?void 0:e.part_detail)==null?void 0:be.thumbnail),pk:e.part})}),s.jsx(H.Col,{span:8,children:s.jsx(L,{fields:F,item:l})})]}),s.jsx(L,{fields:O,item:l}),s.jsx(L,{fields:W,item:l}),s.jsx(L,{fields:Y,item:l})]})},[e,h.isFetching,_]),p=n.useMemo(()=>{var l;return((l=e==null?void 0:e.part_detail)==null?void 0:l.component)&&!(e!=null&&e.sales_order)&&!(e!=null&&e.belongs_to)},[e]),C=n.useMemo(()=>{var l;return(l=e==null?void 0:e.part_detail)==null?void 0:l.salable},[e]),D=ve({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>{var l;return!e.pk||!e.part||!((l=e.part_detail)!=null&&l.assembly)?!1:Z.get(v(m.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(f=>f.status==200?f.data.count>0:null).catch(()=>null)}}),z=n.useMemo(()=>{var l;return e!=null&&e.installed_items?!0:D.data!=null?D.data:(l=e==null?void 0:e.part_detail)==null?void 0:l.assembly},[D,e]),K=n.useMemo(()=>{var l;return[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(Ae,{}),content:A},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(We,{}),content:e.pk?s.jsx(Qt,{itemId:e.pk}):s.jsx(U,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Ye,{}),hidden:!e.in_stock||!C&&!p,content:s.jsxs(P,{multiple:!0,defaultValue:["buildallocations","salesallocations"],children:[p&&s.jsxs(P.Item,{value:"buildallocations",children:[s.jsx(P.Control,{children:s.jsx(je,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(P.Panel,{children:s.jsx(Ut,{stockId:e.pk,modelField:"build",modelTarget:r.build,showBuildInfo:!0})})]},"buildallocations"),C&&s.jsxs(P.Item,{value:"salesallocations",children:[s.jsx(P.Control,{children:s.jsx(je,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(P.Panel,{children:s.jsx(Kt,{stockId:e.pk,modelField:"order",modelTarget:r.salesorder,showOrderInfo:!0})})]},"salesallocations")]})},{name:"testdata",label:t._({id:"dljGeD"}),icon:s.jsx(Ge,{}),hidden:!((l=e==null?void 0:e.part_detail)!=null&&l.testable),content:e!=null&&e.pk?s.jsx(Jt,{itemId:e.pk,partId:e.part}):s.jsx(U,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx(Le,{}),hidden:!z,content:s.jsx(Lt,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Je,{}),hidden:((e==null?void 0:e.child_items)??0)==0,content:e!=null&&e.pk?s.jsx(Mt,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(U,{})},xt({model_type:r.stockitem,model_id:e.pk}),rt({model_type:r.stockitem,model_id:e.pk})]},[C,p,z,e,c,i]),J=n.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(l=>({name:l.name,url:X(r.stocklocation,l.pk)}))],[e]),N=we({create:!1,stockItem:e,partId:e.part}),E=Fe({url:m.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),fields:N,onFormSuccess:o}),Q=we({create:!0}),V=q({url:m.stock_item_list,title:t._({id:"bJLEQT"}),fields:Q,initialData:{...e},follow:!0,modelType:r.stockitem}),a=n.useMemo(()=>{},[e]),u=qe({url:m.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:a,onFormSuccess:()=>{y(X(r.part,e.part))}}),d=n.useMemo(()=>({items:[e],model:r.stockitem,refresh:o,filters:{in_stock:!0}}),[e]),x=Rt(d),T=Dt(d),ae=Ft(d),le=qt(d),ie=zt(d),Be=Et({partId:e.part,trackable:(de=e.part_detail)==null?void 0:de.trackable}),oe=q({url:m.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),fields:Be,initialData:{quantity:e.quantity,destination:e.location??((ce=e.part_detail)==null?void 0:ce.default_location)},onFormSuccess:()=>{const l=e.part;I().catch(()=>{y(X(r.part,l))})},successMessage:t._({id:"Hkw/xj"})}),ne=q({url:m.stock_return,pk:e.pk,title:t._({id:"FY3xEt"}),preFormContent:s.jsx(Qe,{color:"blue",children:t._({id:"xRHE+Q"})}),fields:{location:{},status:{},notes:{}},initialData:{location:e.location??((ue=e.part_detail)==null?void 0:ue.default_location),status:e.status_custom_key??e.status},successMessage:t._({id:"M6A9fW"}),onFormSuccess:()=>{o()}}),re=At({parts:e.part_detail?[e.part_detail]:[]}),Ue=n.useMemo(()=>{var O,W,Y;const l=i.hasChangeRole(k.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&!e.consumed_by&&!e.is_building,f=e.serial,F=f!=null&&f!=null&&f!=""&&e.quantity==1;return[s.jsx(Ze,{model:r.stockitem,id:e.pk}),s.jsx(yt,{stockId:e.pk}),s.jsx(dt,{model:r.stockitem,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:i.hasChangeRole(k.stock)}),s.jsx(lt,{modelType:r.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(ct,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(He,{}),actions:[{name:t._({id:"wBMjJ2"}),tooltip:t._({id:"rb0Klh"}),hidden:F||!l,icon:s.jsx(M,{icon:"stocktake",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&x.open()}},{name:t._({id:"m16xKo"}),tooltip:t._({id:"smUxso"}),hidden:F||!l,icon:s.jsx(M,{icon:"add",iconProps:{color:"green"}}),onClick:()=>{e.pk&&T.open()}},{name:t._({id:"t/YqKh"}),tooltip:t._({id:"dxvf6V"}),hidden:F||!l||e.quantity<=0,icon:s.jsx(M,{icon:"remove",iconProps:{color:"red"}}),onClick:()=>{e.pk&&ae.open()}},{name:t._({id:"zPGNJm"}),tooltip:t._({id:"9efe+k"}),hidden:!l,icon:s.jsx(M,{icon:"transfer",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&le.open()}},{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:!l||F||((O=e==null?void 0:e.part_detail)==null?void 0:O.trackable)!=!0,icon:s.jsx(M,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{oe.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!i.hasAddRole(k.purchase_order)||!((W=e.part_detail)!=null&&W.active)||!((Y=e.part_detail)!=null&&Y.purchaseable),icon:s.jsx(Xe,{color:"blue"}),onClick:()=>{re.openWizard()}},{name:t._({id:"vUOn9d"}),tooltip:t._({id:"CwkTmH"}),hidden:!e.customer,icon:s.jsx(M,{icon:"return_orders",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&ne.open()}},{name:t._({id:"7J5Eno"}),tooltip:t._({id:"Ch8pZV"}),hidden:!!e.customer,icon:s.jsx(M,{icon:"customer",iconProps:{color:"blue"}}),onClick:()=>{e.pk&&ie.open()}}]}),s.jsx(ut,{tooltip:t._({id:"oPF3fX"}),actions:[pt({hidden:!i.hasAddRole(k.stock),onClick:()=>V.open()}),mt({hidden:!i.hasChangeRole(k.stock),onClick:()=>E.open()}),_t({hidden:!i.hasDeleteRole(k.stock),onClick:()=>u.open()})]})]},[c,e,i]),Ke=n.useMemo(()=>{let l=((e==null?void 0:e.quantity)??0)-((e==null?void 0:e.allocated)??0);return l=Math.max(0,l),h.isLoading?[]:[s.jsx(w,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(w,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(w,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${e.quantity}`,visible:!e.serial},"quantity"),s.jsx(w,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${l}`,visible:e.in_stock&&!e.serial&&l!=e.quantity},"available"),s.jsx(w,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(Re,{status:e.status_custom_key||e.status,type:r.stockitem,options:{size:"lg"}},"status"),s.jsx(w,{color:"yellow",label:t._({id:"1ba70W"}),visible:_&&e.stale&&!e.expired},"stale"),s.jsx(w,{color:"orange",label:t._({id:"M1RnFv"}),visible:_&&e.expired},"expired"),s.jsx(w,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,h,_]);return s.jsx(ot,{requiredRole:k.stock,status:R,loading:h.isFetching,children:s.jsxs($e,{children:[i.hasViewRole(k.stock_location)&&s.jsx(kt,{title:t._({id:"1eBWAw"}),modelType:r.stocklocation,endpoint:m.stock_location_tree,opened:j,onClose:()=>g(!1),selectedId:e==null?void 0:e.location}),s.jsx(ht,{title:t._({id:"igx8Og"}),subtitle:(pe=e.part_detail)==null?void 0:pe.full_name,imageUrl:(me=e.part_detail)==null?void 0:me.thumbnail,editAction:E.open,editEnabled:i.hasChangePermission(r.stockitem),badges:Ke,breadcrumbs:i.hasViewRole(k.stock_location)?J:void 0,breadcrumbAction:()=>{g(!0)},actions:Ue}),s.jsx(ft,{pageKey:"stockitem",panels:K,model:r.stockitem,id:e.pk,instance:e}),E.modal,V.modal,u.modal,x.modal,T.modal,ae.modal,le.modal,oe.modal,ne.modal,ie.modal,re.wizard]})})}export{Es as default};
