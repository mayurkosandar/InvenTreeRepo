import{j as e,r as l,bG as C,i as t,d as V,m as j,bI as o,S as c,bW as p,G as W,I as S,aD as M,ax as E,az as z,Z as G,s as N,ff as X,by as k,fg as Z}from"./vendor-BnaqX2_l.js";import{A as m,a as H,c as J,d as U,e as D}from"./index-fPzgLVil.js";import{a as w,u as Q,b as q,c as K}from"./UseForm-DwZIxEnj.js";import{Y as $}from"./YesNoButton-W51do83Q.js";import{D as I}from"./DetailDrawer-M_KAZNzc.js";import{u as ee}from"./UseInstance-DbDyyJjp.js";import{I as r}from"./InfoItem-D6fJaMd4.js";import{C as te,S as P,d as ie}from"./BaseContext-CH9A7-TB.js";import{P as se}from"./SettingList-CWkD4zaU.js";import{u as ae,R as le}from"./RemoteComponent-Who-27QQ.js";import{u as oe,I as re}from"./InvenTreeTable-rEa-i3pt.js";import"./dayjs.min-DlCiWWGX.js";import"./ApiIcon-Bqf-O7I2.js";import"./Instance-DrUTN1gu.js";import"./navigation-B-mN4luC.js";import"./DesktopAppView-CAvOv5f4.js";import"./ActionDropdown-D1A3arjv.js";function de({pluginAdmin:a}){const s=ae();return e.jsx(le,{source:a.source,defaultFunctionName:"renderPluginSettings",context:{...s,context:a.context}})}function ne({pluginKey:a,pluginInstance:s}){const{id:d}=te(),n=l.useMemo(()=>a||d||"",[a,d]),{instance:u}=ee({endpoint:m.plugin_admin,pathParams:{key:n},defaultValue:{},hasPrimaryKey:!1,refetchOnMount:!0}),x=l.useMemo(()=>{var h;return!!((h=s==null?void 0:s.mixins)!=null&&h.settings)},[s]);return s.active?e.jsxs(o,{defaultValue:["plugin-details","plugin-settings"],multiple:!0,children:[e.jsxs(o.Item,{value:"plugin-details",children:[e.jsx(o.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"5HArLW"})})}),e.jsx(o.Panel,{children:e.jsxs(c,{gap:"xs",children:[e.jsx(p,{withBorder:!0,children:e.jsx(c,{gap:"md",children:e.jsxs(c,{pos:"relative",gap:"xs",children:[e.jsx(r,{type:"text",name:t._({id:"6YtxFj"}),value:s==null?void 0:s.name}),e.jsx(r,{type:"text",name:t._({id:"Nu4oKW"}),value:s==null?void 0:s.meta.description}),e.jsx(r,{type:"text",name:t._({id:"VbeIOx"}),value:s==null?void 0:s.meta.author}),e.jsx(r,{type:"text",name:t._({id:"mYGY3B"}),value:s==null?void 0:s.meta.pub_date}),e.jsx(r,{type:"text",name:t._({id:"eE0JZ4"}),value:s==null?void 0:s.meta.version}),e.jsx(r,{type:"boolean",name:t._({id:"F6pfE9"}),value:s==null?void 0:s.active})]})})}),e.jsx(p,{withBorder:!0,children:e.jsx(c,{gap:"md",children:e.jsxs(c,{pos:"relative",gap:"xs",children:[(s==null?void 0:s.is_package)&&e.jsx(r,{type:"text",name:t._({id:"/L+cAM"}),value:s==null?void 0:s.package_name}),e.jsx(r,{type:"text",name:t._({id:"AJd5vK"}),value:s==null?void 0:s.meta.package_path}),e.jsx(r,{type:"boolean",name:t._({id:"++LBSt"}),value:s==null?void 0:s.is_builtin}),e.jsx(r,{type:"boolean",name:t._({id:"mGYa19"}),value:s==null?void 0:s.is_package})]})})})]})})]}),x&&e.jsxs(o.Item,{value:"plugin-settings",children:[e.jsx(o.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"eKHY3W"})})}),e.jsx(o.Panel,{children:e.jsx(p,{withBorder:!0,children:e.jsx(se,{pluginKey:n})})})]}),(u==null?void 0:u.source)&&e.jsxs(o.Item,{value:"plugin-custom",children:[e.jsx(o.Control,{children:e.jsx(P,{size:"lg",children:t._({id:"BFm1Jm"})})}),e.jsx(o.Panel,{children:e.jsx(p,{withBorder:!0,children:e.jsx(de,{pluginAdmin:u})})})]})]}):e.jsx(C,{color:"red",title:t._({id:"nNlKYH"}),icon:e.jsx(V,{}),children:e.jsx(j,{children:t._({id:"xwdvWr"})})})}function me({plugin:a}){return a!=null&&a.is_installed?a!=null&&a.active?e.jsx(k,{label:t._({id:"QqLLp2"}),children:e.jsx(S,{color:"green"})}):e.jsx(k,{label:t._({id:"s99Mc1"}),children:e.jsx(M,{color:"red"})}):e.jsx(k,{label:t._({id:"LtEW/l"}),children:e.jsx(Z,{})})}function Te(){const a=oe("plugin"),s=ie(),d=H(),{server:n}=J(),u=l.useMemo(()=>[{accessor:"name",title:t._({id:"fOuPPd"}),sortable:!0,render:i=>{if(i)return e.jsxs(W,{justify:"left",children:[e.jsx(me,{plugin:i}),e.jsx(j,{children:i.name})]})}},{accessor:"active",sortable:!0,title:t._({id:"F6pfE9"}),render:i=>e.jsx($,{value:i.active})},{accessor:"meta.description",title:t._({id:"Nu4oKW"}),sortable:!1,render:i=>i.active?i==null?void 0:i.meta.description:e.jsx(j,{style:{fontStyle:"italic"},size:"sm",children:t._({id:"9YdyZU"})})},{accessor:"meta.version",title:t._({id:"eE0JZ4"}),sortable:!1,render:i=>i==null?void 0:i.meta.version},{accessor:"meta.author",title:"Author",sortable:!1}],[]),[x,h]=l.useState({}),[b,f]=l.useState(""),[_,A]=l.useState(!1),L=l.useMemo(()=>e.jsx(c,{gap:"xs",children:e.jsx(C,{color:_?"green":"red",icon:e.jsx(S,{}),title:_?t._({id:"fLe7w+"}):t._({id:"oBCe/M"}),children:e.jsx(j,{children:_?t._({id:"th4roR"}):t._({id:"WPCUXx"})})})}),[_]),R=l.useCallback(i=>!d.isSuperuser()||!n.plugins_enabled?[]:[{hidden:i.is_builtin!=!1||i.active!=!0,title:t._({id:"5y3O+A"}),color:"red",icon:e.jsx(M,{}),onClick:()=>{f(i.key),A(!1),v.open()}},{hidden:i.is_builtin!=!1||!i.is_installed||i.active!=!1,title:t._({id:"FQBaXG"}),tooltip:t._({id:"RqdYGI"}),color:"green",icon:e.jsx(S,{}),onClick:()=>{f(i.key),A(!0),v.open()}},{hidden:!i.active||!i.is_package||!i.package_name,title:t._({id:"EkH9pt"}),tooltip:t._({id:"R7mVjI"}),color:"blue",icon:e.jsx(E,{}),onClick:()=>{T(i.package_name),y.open()}},{hidden:!d.isSuperuser()||i.active||i.is_builtin||i.is_sample||!i.is_installed||!i.is_package,title:t._({id:"fo0VXg"}),tooltip:t._({id:"ll8AEP"}),color:"red",icon:e.jsx(M,{}),onClick:()=>{f(i.key),F.open()}},{hidden:i.active||i.is_builtin||i.is_sample||i.is_installed||!d.isSuperuser(),title:t._({id:"cnGeoo"}),tooltip:t._({id:"yX/BXa"}),color:"red",icon:e.jsx(z,{}),onClick:()=>{f(i.key),B.open()}}],[d,n]),[Y,T]=l.useState(""),v=w({title:t._({id:"2RHgaV"}),url:m.plugin_activate,pathParams:{key:b},preFormContent:L,fetchInitialData:!1,method:"POST",successMessage:_?t._({id:"VAuM5b"}):t._({id:"ysKQPq"}),fields:{active:{hidden:!0}},initialData:{active:_},table:a}),y=Q({title:t._({id:"R7k68Z"}),url:m.plugin_install,timeout:3e4,fields:{packagename:{},url:{},version:{},confirm:{}},initialData:{packagename:Y},closeOnClickOutside:!1,submitText:t._({id:"TKQ7K+"}),successMessage:t._({id:"MiYlP5"}),table:a}),F=w({title:t._({id:"mXzRzO"}),url:m.plugin_uninstall,pathParams:{key:b},fetchInitialData:!1,timeout:3e4,fields:{delete_config:{}},preFormContent:e.jsx(C,{color:"red",icon:e.jsx(G,{}),title:t._({id:"6onEou"}),children:e.jsxs(c,{gap:"xs",children:[e.jsx(j,{children:t._({id:"nh4MTY"})}),e.jsx(j,{children:t._({id:"U99rVM"})})]})}),successMessage:t._({id:"MAZU/W"}),table:a}),B=q({url:m.plugin_list,pk:b,fetchInitialData:!1,title:t._({id:"nud26y"}),preFormWarning:t._({id:"vb5uIh"}),table:a}),g=l.useCallback(()=>{U.post(D(m.plugin_reload),{full_reload:!0,force_reload:!0,collect_plugins:!0}).then(()=>{N({title:t._({id:"Bs76+T"}),message:t._({id:"js1VzJ"}),color:"green"}),a.refreshTable()})},[]),O=l.useMemo(()=>!d.isSuperuser()||!n.plugins_enabled?[]:[e.jsx(K,{color:"green",icon:e.jsx(E,{}),tooltip:t._({id:"2VWTDu"}),onClick:g},"reload"),e.jsx(K,{color:"green",icon:e.jsx(X,{}),tooltip:t._({id:"0O/OZv"}),onClick:()=>{T(""),y.open()},disabled:n.plugins_install_disabled||!1},"install")],[d,n]);return e.jsxs(e.Fragment,{children:[y.modal,F.modal,B.modal,v.modal,e.jsx(I,{title:`${t._({id:"NCjc4L"})} - ${x==null?void 0:x.name}`,size:"65%",renderContent:i=>{if(i)return e.jsx(ne,{pluginKey:i,pluginInstance:x})}}),e.jsx(re,{url:D(m.plugin_list),tableState:a,columns:u,props:{enableDownload:!1,rowActions:R,onRowClick:i=>{h(i),s(`${i.key}/`)},tableActions:O,tableFilters:[{name:"active",label:t._({id:"F6pfE9"}),type:"boolean"},{name:"builtin",label:t._({id:"++LBSt"}),type:"boolean"},{name:"sample",label:t._({id:"LcJmOR"}),type:"boolean"},{name:"installed",label:t._({id:"eQkgKV"}),type:"boolean"}]}})]})}export{Te as default};
