import{r as i,i as t,j as o,G as R,ci as J,m as O,Z as U,a1 as T,bk as V,S as W}from"./vendor-BnaqX2_l.js";import{A as z}from"./AdminButton-GD-Bfrm9.js";import{u as G,R as K,I as Z,P as q}from"./InvenTreeTable-rEa-i3pt.js";import{I as Y,D as P,a as X}from"./InstanceDetail-DvLVYRQt.js";import{B as H,A as $,O as ee,E as te,D as oe}from"./ActionDropdown-D1A3arjv.js";import{A as f}from"./ApiIcon-Bqf-O7I2.js";import{N as se}from"./NavigationTree-B_DMouOz.js";import{P as ae}from"./PageDetail-Ct_zKLxm.js";import{P as ie}from"./PanelGroup-CKTRVRga.js";import{L as ne}from"./LocateItemButton--RRdFqor.js";import{a as B,e as v,A as l,m as n,U as u,f as F,D as L}from"./index-fPzgLVil.js";import{s as A,S as ce,a as le,u as re}from"./StockItemTable-Blig3z9s.js";import{C as de,d as me,I as k}from"./BaseContext-CH9A7-TB.js";import{u as pe,a as N,A as ue,b as _e}from"./UseForm-DwZIxEnj.js";import{u as ke}from"./UseInstance-DbDyyJjp.js";import{P as be}from"./PartTable-DaVQ6v7O.js";import{b as xe}from"./UseFilter-qbbXWiSh.js";import{D as he,B as M}from"./ColumnRenderers-6jyK6a0i.js";import"./DesktopAppView-CAvOv5f4.js";import"./navigation-B-mN4luC.js";import"./dayjs.min-DlCiWWGX.js";import"./formatters-DBeaC9UC.js";import"./YesNoButton-W51do83Q.js";import"./Instance-DrUTN1gu.js";import"./GenericErrorPage-BDqvbBMU.js";import"./NotFound-Dr2EC1Qm.js";import"./PermissionDenied-BHX44oqK.js";import"./PageTitle-AnZP781e.js";import"./RemoteComponent-Who-27QQ.js";import"./OrderPartsWizard-BFgDSSVd.js";import"./CompanyForms-yUzzFM8E.js";import"./PurchaseOrderForms-DPVzsVCo.js";import"./RemoveRowButton-Dm_wD7jw.js";import"./UseGenerator-DOw_SLei.js";import"./UsePlaceholder-Dc_Ugorx.js";import"./PartForms-CscLTjK3.js";function fe({parentId:r}){const s=G("stocklocation"),d=B(),c=xe({url:v(l.stock_location_type_list),transform:a=>({value:a.pk,label:a.name})}),j=i.useMemo(()=>[{name:"cascade",label:t._({id:"VY386J"}),description:t._({id:"Ue7Vtx"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"zW8WBT"})},{name:"external",label:t._({id:"bVhrVt"}),description:t._({id:"ckSQBM"})},{name:"has_location_type",label:t._({id:"Sgyhpp"})},{name:"location_type",label:t._({id:"4sg5Qp"}),description:t._({id:"buIdz6"}),choices:c.choices}],[c.choices]),b=i.useMemo(()=>[{accessor:"name",switchable:!1,render:a=>o.jsxs(R,{gap:"xs",children:[a.icon&&o.jsx(f,{name:a.icon}),a.name]})},he({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},M({accessor:"structural"}),M({accessor:"external"}),{accessor:"location_type",sortable:!1,render:a=>{var m;return(m=a.location_type_detail)==null?void 0:m.name}}],[]),e=pe({url:l.stock_location_list,title:t._({id:"sklcDg"}),fields:A(),focus:"name",initialData:{parent:r},follow:!0,modelType:n.stocklocation,table:s}),[x,_]=i.useState(-1),h=N({url:l.stock_location_list,pk:x,title:t._({id:"Qdjbg8"}),fields:A(),onFormSuccess:a=>s.updateRecord(a)}),g=i.useMemo(()=>{const a=d.hasAddRole(u.stock_location);return[o.jsx(ue,{tooltip:t._({id:"sklcDg"}),onClick:()=>e.open(),hidden:!a},"add-stock-location")]},[d]),y=i.useCallback(a=>{const m=d.hasChangeRole(u.stock_location);return[K({hidden:!m,onClick:()=>{_(a.pk),h.open()}})]},[d]);return o.jsxs(o.Fragment,{children:[e.modal,h.modal,o.jsx(Z,{url:v(l.stock_location_list),tableState:s,columns:b,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:r,top_level:r===void 0?!0:void 0},tableFilters:j,tableActions:g,rowActions:y,modelType:n.stocklocation}})]})}function ot(){const{id:r}=de(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(r||""))?void 0:r,[r]),d=me(),c=B(),[j,b]=i.useState(!1),{instance:e,refreshInstance:x,instanceQuery:_,requestStatus:h}=ke({endpoint:l.stock_location_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),g=i.useMemo(()=>{if(s&&_.isFetching)return o.jsx(J,{});const p=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>o.jsxs(R,{gap:"xs",children:[e.icon&&o.jsx(f,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"+o9hiJ"}),model:n.stocklocation,hidden:!(e!=null&&e.parent)}],Q=[{type:"text",name:"items",icon:"stock",label:t._({id:"Jbck4N"}),value_formatter:()=>(e==null?void 0:e.items)||"0"},{type:"text",name:"sublocations",icon:"location",label:t._({id:"L7/8CO"}),hidden:!(e!=null&&e.sublocations)},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:t._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:t._({id:"4sg5Qp"}),hidden:!(e!=null&&e.location_type),icon:"packages"}];return o.jsxs(Y,{children:[s&&(e!=null&&e.pk)?o.jsx(P,{item:e,fields:p}):o.jsx(O,{children:t._({id:"js9HzF"})}),s&&(e==null?void 0:e.pk)&&o.jsx(P,{item:e,fields:Q})]})},[e,_]),y=i.useMemo(()=>[{name:"details",label:t._({id:"AC8C/Z"}),icon:o.jsx(U,{}),content:g},{name:"stock-items",label:t._({id:"Jbck4N"}),icon:o.jsx(T,{}),content:o.jsx(ce,{tableName:"location-stock",allowAdd:!0,params:{location:s}})},{name:"sublocations",label:t._({id:"1eBWAw"}),icon:o.jsx(V,{}),content:o.jsx(fe,{parentId:s})},{name:"default_parts",label:t._({id:"D19W4x"}),icon:o.jsx(T,{}),hidden:!e.pk,content:o.jsx(be,{props:{params:{default_location:e.pk}}})}],[e,s]),a=N({url:l.stock_location_list,pk:s,title:t._({id:"Qdjbg8"}),fields:A(),onFormSuccess:x}),m=i.useMemo(()=>[{value:0,display_name:t._({id:"+oqXDN"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),I=_e({url:l.stock_location_list,pk:s,title:t._({id:"lnETLa"}),fields:{delete_stock_items:{label:t._({id:"j3pJx8"}),description:t._({id:"Ml7+Iv"}),field_type:"choice",choices:m},delete_sub_location:{label:t._({id:"+DlcAh"}),description:t._({id:"CEDjmR"}),field_type:"choice",choices:m}},onFormSuccess:()=>{e.parent?d(F(n.stocklocation,e.parent)):d("/stock/")}}),S=i.useMemo(()=>({pk:e.pk,model:"location",refresh:x,filters:{in_stock:!0}}),[e]),C=le(S),D=re(S),w=i.useMemo(()=>[o.jsx(z,{model:n.stocklocation,id:e.pk}),o.jsx(ne,{locationId:e.pk}),e.pk?o.jsx(H,{model:n.stocklocation,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:c.hasChangeRole(u.stock_location),actions:[{name:"Scan in stock items",icon:o.jsx(k,{icon:"stock"}),tooltip:"Scan items",onClick:L},{name:"Scan in container",icon:o.jsx(k,{icon:"unallocated_stock"}),tooltip:"Scan container",onClick:L}]}):null,o.jsx(q,{modelType:n.stocklocation,items:[e.pk??0],hidden:!(e!=null&&e.pk),enableLabels:!0,enableReports:!0}),o.jsx($,{tooltip:t._({id:"bbA1t1"}),icon:o.jsx(k,{icon:"stock"}),actions:[{name:t._({id:"n/p2QJ"}),icon:o.jsx(k,{icon:"stocktake",iconProps:{color:"blue"}}),tooltip:t._({id:"n/p2QJ"}),onClick:()=>D.open()},{name:"Transfer Stock",icon:o.jsx(k,{icon:"transfer",iconProps:{color:"blue"}}),tooltip:"Transfer Stock",onClick:()=>C.open()}]}),o.jsx(ee,{tooltip:t._({id:"Ego4rz"}),actions:[te({hidden:!s||!c.hasChangeRole(u.stock_location),tooltip:t._({id:"Qdjbg8"}),onClick:()=>a.open()}),oe({hidden:!s||!c.hasDeleteRole(u.stock_location),tooltip:t._({id:"lnETLa"}),onClick:()=>I.open()})]})],[e,s,c]),E=i.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.path??[]).map(p=>({name:p.name,url:F(n.stocklocation,p.pk),icon:p.icon?o.jsx(f,{name:p.icon}):void 0}))],[e]);return o.jsxs(o.Fragment,{children:[a.modal,I.modal,o.jsx(X,{status:h,loading:s?_.isFetching:!1,requiredRole:u.stock_location,children:o.jsxs(W,{children:[o.jsx(se,{title:t._({id:"1eBWAw"}),modelType:n.stocklocation,endpoint:l.stock_location_tree,opened:j,onClose:()=>b(!1),selectedId:e==null?void 0:e.pk}),o.jsx(ae,{title:t._({id:"Jbck4N"}),subtitle:e==null?void 0:e.name,icon:(e==null?void 0:e.icon)&&o.jsx(f,{name:e==null?void 0:e.icon}),actions:w,editAction:a.open,editEnabled:c.hasChangePermission(n.stocklocation),breadcrumbs:E,breadcrumbAction:()=>{b(!0)}}),o.jsx(ie,{pageKey:"stocklocation",panels:y,model:n.stocklocation,id:e.pk??null,instance:e}),C.modal,D.modal]})})]})}export{ot as default};
